---
id: m-180f
status: open
deps: []
created: 2026-02-19T19:05:18Z
type: feature
priority: 0
assignee: Adam Avenir
---
# Create @mlld/fs standard library module for filesystem helpers

## Summary

Every orchestrator in llm/run/ and plugins/mlld/examples/ defines the same shell-wrapper filesystem helpers: @mkdirp, @fileExists, @countFiles, @tailFile, etc. These should be consolidated into an importable @mlld/fs standard library module.

Note: @fileExists was recently added as a built-in. This ticket should evaluate whether it belongs in @mlld/fs instead of (or in addition to) being a built-in, for consistency.

## Helpers found across orchestrators

| Helper | Definition | Found in |
|--------|-----------|----------|
| @mkdirp(dir) | sh { mkdir -p "$dir" } | j2bd, qa, review, review-docs, doc-audit, polish, all plugin examples |
| @fileExists(path) | sh { test -f "$path" && echo "yes" \|\| echo "no" } | review, review-docs, doc-audit, j2bd (also recently added as built-in) |
| @countFiles(dir) / @countDir(dir) | sh { ls -1 "$dir" 2>/dev/null \| wc -l \| tr -d ' ' } | j2bd, qa, research example |
| @tailFile(path, limit) | sh { tail -n "$limit" "$path" 2>/dev/null } | j2bd, qa |
| @countRunsForDate(dir, date) | sh { ls "$dir" 2>/dev/null \| grep "^$date" \| wc -l \| tr -d ' ' } | j2bd, qa |

## Files where user-defined helpers exist

- llm/run/j2bd/index.mld (lines 46-52)
- llm/run/j2bd/lib/context.mld (lines 3-6)
- llm/run/qa/lib/state.mld (lines 6-16)
- llm/run/review/lib/context.mld (lines 1-4)
- llm/run/review-docs/lib/context.mld
- llm/run/doc-audit/lib/context.mld (line 3)
- plugins/mlld/examples/development/index.mld
- plugins/mlld/examples/research/index.mld
- plugins/mlld/examples/audit/index.mld

## Proposed API

```mlld
import { @mkdirp, @exists, @countFiles, @tailFile } from "@mlld/fs"
```

### Functions to include

- @mkdirp(dir) — Create directory and parents
- @exists(path) — Check if file/dir exists (returns boolean, not "yes"/"no" string)
- @isFile(path) — Check if path is a regular file
- @isDir(path) — Check if path is a directory
- @countFiles(dir) — Count files in directory (returns number)
- @tailFile(path, n) — Read last n lines of a file
- @listDir(dir) — List directory contents as array

### Design decisions to make

1. Return types: Current user-defined helpers return strings ("yes"/"no", "3"). The stdlib versions should return proper types (boolean, number, array).
2. Built-in @fileExists: Should it stay as a built-in AND be re-exported from @mlld/fs? Or move entirely to the module?
3. Implementation: Shell wrappers vs. native JS implementations for performance.

## Implementation approach

1. Look at how existing @mlld/ modules are structured (e.g., @mlld/claude-poll)
2. Create the module with the helpers listed above
3. Update orchestrators and examples to import from @mlld/fs instead of defining their own
4. Document in docs/user/ or wherever stdlib modules are documented

## Getting up to speed

- Module system: Read docs/dev/MODULES.md for how @mlld/ imports work
- Existing modules: Look at @mlld/claude-poll as a reference for module structure
- Current helpers: Search for "exe @mkdirp" and "exe @fileExists" across the codebase to see all variants
- Built-in @fileExists: Search src/ for "fileExists" to find the recent built-in implementation

