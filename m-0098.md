---
id: m-0098
status: open
deps: []
created: 2026-02-09T19:30:11Z
type: feature
priority: 2
assignee: Adam
---
# Support bare @func() invocation as standalone statement

Allow bare @func() as a standalone statement (equivalent to run @func()). Executes the function silently and captures the return value. This reduces ceremony for the most common operation in mlld scripts.

Semantics: silent execution (like run). Use show @func() to display the result.

Syntax by mode:
- Strict mode (.mld): @func() on its own line
- Markdown mode (.md): /@func() (needs directive prefix to distinguish from prose)

run @func() continues to work — this is additive, not a replacement.

Examples:
  @claude(@prompt)              # call, capture result silently
  var @result = @claude(@prompt) # call, assign result
  show @claude(@prompt)          # call, display result
  run @claude(@prompt)           # still works, same as bare invocation
  log @claude(@prompt)           # call, display to stderr

Grammar considerations:
- In strict mode, a line starting with @identifier( can be parsed as a bare invocation statement
- In markdown mode, /@identifier( serves as the directive marker
- Must not conflict with @var references in template/interpolation contexts (those are RHS, not statement-level)
- Must not conflict with var @x = @func() assignments (the = disambiguates)

## Design

Grammar: Add a new top-level directive alternative that matches @identifier(...) in statement position. In strict mode this is a bare @-prefixed invocation. In markdown mode it requires the / prefix (/@func()).

Evaluator: Route to the existing exec invocation evaluation path (same as run @func()). Return value captured silently, effect emission follows run semantics.

Key constraint: This is strictly a statement-level construct. @func() in expression contexts (templates, var RHS, let bindings) already works and is unchanged.

## Acceptance Criteria

1. @func() as a standalone line in .mld files executes the function silently
2. /@func() works in markdown mode
3. run @func() continues to work identically
4. Return value is captured and available (e.g., in for loops, let bindings)
5. Does not affect @func() in expression/interpolation contexts
6. show @func() still prints the result (unchanged)
7. Parser does not misparse @varName (without parens) as an invocation


**2026-02-09 20:03 UTC:** ## Design Clarifications

1. Bare @func() is truly equivalent to /run @func() — same output behavior (emits to stdout for top-level directives), same security checks, same everything. Pure syntactic sugar.

2. @obj.method() should also work as bare statement (e.g., @http.get(), @json.parse()). Grammar already handles this via UnifiedReferenceWithTail — just need the predicate to accept both ExecInvocation forms.

3. Markdown mode: only /@fn() — confirmed. Bare @fn() in markdown is ambiguous with prose.

4. LSP: synthetic run nodes need meta.isBareInvocation (or similar) so LSP/tokenizer doesn't render a /run keyword that doesn't exist in source text.

**2026-02-09 20:19 UTC:** Implementation plan (stability-first): 1) Grammar: add statement-level bare invocation syntax sugar for run invocation: strict mode allows @func()/@obj.method() at line start; markdown mode requires /@func()/ /@obj.method(). Reuse UnifiedReferenceWithTail and gate to ExecInvocation only (never parse bare @var as invocation). 2) AST mapping: emit synthetic run directive equivalent to /run @... with metadata flag (meta.isBareInvocation=true) to preserve source-accurate tooling behavior and avoid LSP rendering assumptions about /run text. 3) Runtime semantics: route through existing run exec invocation path so behavior matches /run @... exactly (effects/output/security/policy/retry/pipelines). 4) LSP/visitors: account for bare-invocation metadata so directive tokenization does not require a literal /run in source. 5) Tests: add strict/markdown parsing coverage, ensure @var (no parens) is not misparsed, verify parity with /run @... and unchanged behavior for show @.../var RHS/interpolation, then run targeted suites and full npm test.
