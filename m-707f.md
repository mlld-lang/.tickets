---
id: m-707f
status: closed
deps: []
created: 2026-02-22T17:20:12Z
type: bug
priority: 0
assignee: Adam Avenir
tags: [mcp, error-handling]
updated: 2026-02-22T18:48:46Z
---
# Wrong MCP tool name gives 'Circular reference detected' instead of 'Tool not found'

## Current behavior

Given an exported exe `@greetUser`, MCP exposes it as `greet_user` (snake_case). When a client calls it by the wrong name `greetUser` (camelCase), the error is:

```
Circular reference detected: executable @greetUser calls itself recursively without a terminating condition
```

This is confusing and wrong â€” there is no circular reference.

## Expected behavior

Error should be: `Tool not found: 'greetUser'. Did you mean 'greet_user'?`

## Fix

In `cli/mcp/FunctionRouter.ts`: validate the incoming tool name against the registered MCP tool name map **before** attempting to resolve and execute it. If the name isn't in the map, return a "tool not found" error with a suggestion (check if a snake_case or camelCase variant exists in the map).

