---
id: m-219f
status: closed
deps: []
created: 2026-02-25T15:36:46Z
type: bug
priority: 0
updated: 2026-02-25T19:31:45Z
---
# stream in exe definition does not set up adapter pipeline

## Bug

When the `stream` keyword is in the exe definition, the format adapter pipeline is not activated during execution. The streaming infrastructure only activates when `stream` appears at the invocation site.

## Reproduce

Create `tmp/repro-stream-exe-def.mld`:

```mlld
exe @a(p) = stream cmd {echo '{"type":"text","text":"from definition"}'}
run @a("test") with { streamFormat: "claude-code" }

exe @b(p) = cmd {echo '{"type":"text","text":"from invocation"}'}
run stream @b("test") with { streamFormat: "claude-code" }
```

Run: `mlld tmp/repro-stream-exe-def.mld`

**Actual:** First call dumps raw JSON. Second call prints `from invocation`.
**Expected:** Both print just the extracted text.

## What to fix

The code that detects whether streaming is requested and sets up the StreamingManager + FormatAdapterSink (look in `interpreter/eval/exec/streaming.ts`) checks for the `stream` keyword on the invocation node. It also needs to check the exe definition's `stream` flag (set during exe parsing when `stream` precedes the executor keyword).

This is the root cause. Ticket m-36c3 (streamFormat propagation) is a separate but related issue.

## Verify

Both calls in the repro should print extracted text, not raw JSON.

## Acceptance Criteria

`exe @x = stream cmd {...}` followed by `run @x()` or `show @x()` activates the full streaming adapter pipeline.

**2026-02-25 19:31 UTC:** Fixed definition-level stream propagation in exec/run/show paths with regression coverage (commit 938cc7967).
