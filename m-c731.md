---
id: m-c731
status: open
deps: []
created: 2026-01-31T12:22:08Z
type: bug
priority: 2
assignee: Adam
tags: [needs-human-design]
updated: 2026-01-31T12:22:12Z
---
# sh block parameters: error on undefined variables passed as arguments

## Problem

When an undefined variable is passed as an argument to a sh block function, mlld passes the literal variable name string instead of erroring:

```mlld
exe @testSh(prompt) = sh { echo "got: $prompt" }
var @result = @testSh(@undefinedVar)
// outputs: got: @undefinedVar
```

This caused a subtle bug in j2bd where `@buildTask` silently failed, leaving `@task` undefined. When `@claudePollEvent(@task, ...)` was called, agents received the literal string "@task" as their prompt instead of the 100KB interpolated template.

## Nuance

The current behavior of passing literal "@" strings is intentional for plain text containing @ symbols (emails, social handles, etc.). We don't want `user@example.com` to error.

The difference is **intent**:
- `@undefinedVar` as a function argument → clearly intended to be a variable, should error
- `user@example.com` in template text → not intended as a variable, should pass through

## Proposed behavior

When a variable reference is used as a **function argument** (not in template text), and that variable is undefined, throw an error:

```
Error: Undefined variable '@task' passed to function @claudePollEvent
```

This preserves the convenience of @ in plain text while catching bugs where variables are expected but undefined.

