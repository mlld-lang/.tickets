---
id: m-3870
status: closed
deps: []
links: []
created: 2026-02-24T11:04:27Z
type: bug
priority: 0
assignee: Adam
tags: [grammar, parser, comments]
updated: 2026-02-24T11:19:53Z
---
# Two consecutive comments inside for/if blocks cause parse error

Two or more consecutive `>>` comment lines inside `for` or `if` blocks cause a parse error on the next directive. Single comments work fine. `exe` blocks are unaffected.

## Minimal reproduction

```mlld
if true [
  >> first comment
  >> second comment
  show "hello"
]
```

Error: `Parse error: Expected end of input but " " found` pointing at the `show` line.

Also fails in `for` blocks:

```mlld
for @item in [1, 2] [
  >> first comment
  >> second comment
  show @item
]
```

## Works fine

Single comment in for/if:
```mlld
if true [
  >> single comment is fine
  show "hello"
]
```

Two comments in exe blocks (unaffected):
```mlld
exe @fn() = [
  >> first comment
  >> second comment
  => "hello"
]
```

## Likely cause

Grammar rule for block bodies in `for`/`if` handles comment consumption differently than `exe` blocks. The comment rule probably consumes one comment + whitespace but doesn't loop, so the second comment falls through and the leading whitespace of the next line triggers the parse error.


## Notes

**2026-02-24T11:10:05Z** Fixed parser handling for consecutive indented block comments in if/for bodies by allowing HWS before LeadingBlockComment. Added grammar regression tests in grammar/tests/regression/consecutive-block-comments.test.ts and verified with targeted vitest run.
