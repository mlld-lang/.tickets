---
id: m-42b4
status: closed
deps: []
created: 2026-02-16T05:05:44Z
type: bug
priority: 0
assignee: Adam
updated: 2026-02-16T05:22:43Z
---
# Fix cwd override with => result collection in blocks

run cmd:@dir works for side effects inside for/when blocks, but fails when collecting results via =>. The cwd mechanism itself works â€” only the => result collection path loses the cwd context.

Example that fails:
var @results = for @dir in @dirs [
  => run cmd:@dir { pwd }
]
>> cwd override is ignored, all results show default cwd

## Key files
- interpreter/eval/run-modules/run-command-executor.ts (lines 329-334): resolveWorkingDirectory()
- The => collection path likely creates a new evaluation context that doesn't propagate workingDir

## Acceptance criteria
- run cmd:@dir { command } with => in for loops captures output with correct cwd
- run cmd:@dir { command } with => in when blocks captures output with correct cwd
- Side-effect-only run cmd:@dir continues to work in all contexts
- Add test cases for => result collection with cwd override in tests/cases/

