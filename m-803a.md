---
id: m-803a
status: closed
deps: []
created: 2026-02-25T00:04:37Z
type: task
priority: p0
assignee: Adam Avenir
updated: 2026-02-25T00:33:49Z
---
# ## Context

The docs atom directory structure has been reorganized (see atoms/ vs atoms-old/). The new structure uses filesystem conventions to encode hierarchy and ordering, replacing categories.json as the source of truth.

## New directory structure

```
atoms/
  intro.md                   (root — LLM quickstart)
  cli/           (7 atoms)
  config/        (14 atoms)
  core/          (30 atoms)
  effects/       (18 atoms)
  flow-control/  (21 atoms)
  mcp/           (5 atoms)
  modules/       (21 atoms)
  output/        (4 atoms)
  patterns/      (3 atoms)
  sdk/           (7 atoms)
  security/      (13 atoms)
```

## Filesystem conventions (the build must implement these)

### File naming
- `NN-parent--child.md` — grouped under `## Parent` as `### Child`
- `NN-standalone.md` — standalone `## Standalone`
- `NN-parent.md` (no `--`, but children with same parent follow) — `## Parent` intro content
- `_index.md` — section intro, always first (before numbered items)
- Unnumbered files sort alphabetically AFTER any numbered items (safety net for newly added docs)

### Basics convention
- First item in a multi-atom group is always `NN-parent--basics.md`
- Build script: when rendering `--basics`, SKIP the `### Basics` heading — content flows directly under the `## Parent` heading
- All other children get their `### Title` heading as normal

### Ordering rules
1. `_index.md` is always first (if it exists)
2. Numbered items (`NN-*`) sort numerically
3. Unnumbered items sort alphabetically after numbered items
4. This ensures docs never get lost just because they were added without convention

## What needs to change

### 1. DELETE categories.json
The filesystem IS the hierarchy now. `docs/build/categories.json` should be removed entirely. All ordering, grouping, and parent-child relationships are derived from the `NN-parent--child.md` filename convention.

### 2. Rewrite website/src/convertDocs.js
Currently reads categories.json for structure. Must be rewritten to:
- Glob each section directory (`atoms/core/`, `atoms/flow-control/`, etc.)
- Sort files: _index.md first, then NN-* numerically, then unnumbered alphabetically
- Parse `--` delimiter to determine parent-child grouping
- For `--basics` items, skip the child heading (content flows under parent h2)
- Generate one page per section directory (each dir = one website page)
- Read _index.md for section title and intro text
- Read atom frontmatter for titles
- Support `experimental: true` in frontmatter → add CSS class to the section/heading wrapper

Website-specific metadata (navOrder, titleOverride) should move into `_index.md` frontmatter or a small config, NOT a separate JSON file. Alphabetical sidebar ordering by directory name is the default; override only where needed.

### 3. Rewrite llm/run/llmstxt.mld
Currently reads categories.json for page structure. Must be rewritten to:
- Glob each section directory
- Apply same sorting/grouping rules as convertDocs.js
- Wrap in pseudo-XML tags using the same parent-child logic
- Build per-section llm module files
- Assemble llms-combined.txt

### 4. Rewrite llm/run/howto.mld
Currently hardcodes section names and loads atoms by old directory paths:
```
var @syntaxAtoms = <@root/docs/src/atoms/syntax/*.md>
var @commandsAtoms = <@root/docs/src/atoms/commands/*.md>
...
```
Must be updated to new directory names:
```
var @cliAtoms = <@root/docs/src/atoms/cli/*.md>
var @configAtoms = <@root/docs/src/atoms/config/*.md>
var @coreAtoms = <@root/docs/src/atoms/core/*.md>
var @effectsAtoms = <@root/docs/src/atoms/effects/*.md>
var @flowControlAtoms = <@root/docs/src/atoms/flow-control/*.md>
var @mcpAtoms = <@root/docs/src/atoms/mcp/*.md>
var @modulesAtoms = <@root/docs/src/atoms/modules/*.md>
var @outputAtoms = <@root/docs/src/atoms/output/*.md>
var @patternsAtoms = <@root/docs/src/atoms/patterns/*.md>
var @sdkAtoms = <@root/docs/src/atoms/sdk/*.md>
var @securityAtoms = <@root/docs/src/atoms/security/*.md>
```

Also update:
- `@bundleAtoms` call and object keys
- `@isSection` function's hardcoded section list
- `@buildTree` category display order
- CLI help text in howto.ts (line 208: the Sections list)

### 5. Update website sidebar template (docs.njk)
Current sidebar has two flat sections: Documentation (explainers) and Reference (categories). Should be updated to:
- Support section headers in sidebar (non-clickable grouping labels)
- Consider moving page outline (h2/h3 TOC) to a right-rail column instead of expanding inline in left sidebar
- Each section directory becomes its own page in the sidebar

### 6. Merge/remove explainers
- `docs/src/explainers/modules-and-registry.md` — content has been folded into atoms in modules/. This explainer should be removed.
- `docs/src/explainers/sdk.md` — content is now in sdk/ atoms. This explainer should be removed. SDK shows as a section page generated from atoms, not a separate explainer.
- `docs/src/explainers/index.md`, `introduction.md`, `quickstart.md` — keep as explainers (they're conceptual/getting-started content, not reference)

### 7. Add experimental flag support
- Atom frontmatter gains optional `experimental: true`
- convertDocs.js: when rendering an atom with `experimental: true`, wrap its section in a div/span with `class="experimental"`
- CSS class is sufficient for now; visual treatment TBD

### 8. Update frontmatter on moved atoms
Many atoms still have stale `category` and `parent` fields in their frontmatter from before the reorg. These should be updated to match their new locations, but this is lower priority since the build no longer depends on these fields for structure (it uses the filesystem).

### 9. Update dev docs
- `docs/dev/DOCS-LLM.md` — references old directory structure, categories.json, old llmstxt.mld behavior
- `docs/dev/DOCS-CLI.md` — references old atom format and directory structure
- Both need updating to reflect new filesystem conventions

### 10. Clean up atoms-old
Once everything builds and passes:
- Verify all non-.MOVED/.DROPPED files in atoms-old have been accounted for
- Remove atoms-old directory
- Remove docs/build/categories.json

## Key principle
The filesystem is the single source of truth. If you can `ls` the directory structure and understand the hierarchy, the build is correct. No hidden config files, no arrays to forget to update.


**2026-02-25 00:33 UTC:** Completed steps 1-9. Step 10 (atoms-old cleanup) deferred — security/examples/ has runnable demo scripts to review. categories.json deleted. docs/build/ removed. All three build systems working: website (18 pages), mlld howto (11 sections), mlld run llmstxt (11 section files + combined).
