---
id: m-286c
status: closed
deps: []
created: 2026-02-11T23:03:17Z
type: feature
priority: 1
assignee: Adam
updated: 2026-02-12T02:38:32Z
---
# mlld live --stdio

Add a long-running stdio JSON protocol mode to mlld. Spawns mlld as a persistent process that reads NDJSON requests on stdin and writes NDJSON events/responses on stdout. Enables real-time streaming events, amortized Node.js startup cost, and full SDK parity with the TS SDK from any language.

## Design

Protocol: newline-delimited JSON over stdio. Request format: {method, id, params}. Response format: {result: {id, ...}} for completion, {event: {type, ...}} for streaming events. Methods: process(script), execute(filepath, payload, state, dynamicModules), analyze(filepath). Streaming: events emitted as they fire (stream:chunk, effect, command:start/complete, state:write, execution:complete, debug:*, streaming:*). Cancel: send {method: 'cancel', id: N} or close stdin. Stateless per-call — no session accumulation. Each call gets a fresh Environment. The interpreter already emits all needed events via StreamBus → ExecutionEmitter; this adds a stdio transport layer. CLI: mlld live --stdio.

## Acceptance Criteria

- mlld live --stdio starts a persistent process reading NDJSON on stdin
- Supports process, execute, and analyze methods matching existing SDK surface
- Streams SDKEvent types as NDJSON lines during execution
- Returns StructuredResult as final response per request
- Stateless per call (no environment carried between requests)
- Cancellation via cancel message or stdin close
- AST cache persists across calls within the process lifetime
- Clean shutdown on stdin EOF or SIGTERM

