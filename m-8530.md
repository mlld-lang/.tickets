---
id: m-8530
status: closed
deps: []
links: []
created: 2026-01-24T23:08:03Z
type: bug
priority: 1
assignee: Adam Avenir
parent: m-2af3
---
# Tool name normalization breaks lookups for non-camelCase keys

## Problem

FunctionRouter converts MCP tool names to camelCase before looking up in toolCollection, but tool collection keys are user-supplied and may be snake_case.

**Code path:**
1. Tool collection defined: `{ create_issue: { mlld: @createIssue } }`
2. Schema generated with snake_case: `create_issue`
3. MCP client calls `create_issue`
4. FunctionRouter.ts:41 converts: `mcpNameToMlldName("create_issue")` â†’ `createIssue`
5. Lookup at line 53 fails: `toolCollection["createIssue"]` when key is `"create_issue"`

## Fix Options

1. Normalize tool collection keys at creation time in `normalizeToolCollection`
2. Look up by both raw and normalized names in FunctionRouter
3. Add a shared utility for consistent name handling

## Files
- cli/mcp/FunctionRouter.ts:41, 53
- cli/mcp/SchemaGenerator.ts:8, 17
- interpreter/eval/var.ts (normalizeToolCollection)

## Tests Needed
- Tool collection with snake_case keys
- Tool collection with hyphenated keys
- Tool collection with leading digits

