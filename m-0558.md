---
id: m-0558
status: closed
deps: []
created: 2026-02-16T16:55:44Z
type: task
priority: 0
assignee: Adam
tags: [docs, security, p0, qa-driven]
updated: 2026-02-16T17:28:27Z
---
# Restructure security docs: operation guards as core path, label-entry guards as advanced

## Problem

QA run 2026-02-16-0 found guard type confusion as the #1 source of security doc failures. Agents repeatedly confused label-entry guards (before LABEL) with operation guards (before op:TYPE). The current docs intermix them in the same atoms, making the core security story hard to follow.

## Core use case: prompt injection defense

The primary security story is taint tracking to prevent prompt injection consequences:

1. Label data with trust/sensitivity (secret, untrusted, src:user)
2. Track label propagation through the system (taint tracking)
3. Block labeled data at trust boundaries using operation guards

The canonical example is NOT filtering API keys (that's architecturally trivial). It's:
- An LLM reads private/sensitive/proprietary data
- That data gets labeled (secret, proprietary, etc.)
- The LLM makes a tool call that could exfiltrate that data
- Operation guards block the labeled data from crossing the trust boundary
- Denied handlers provide graceful degradation

This is the hard problem that taint tracking + guards actually solves.

## Restructuring

**Core path (what 90% of users need):**
- Security intro/getting-started: center the prompt injection defense story
- Labels: mark data with trust/sensitivity
- Operation guards (before op:TYPE): block labeled data at trust boundaries
- Denied handlers: graceful degradation when data is blocked
- Policies: declarative rules for label flow

**Advanced (separate atoms, clearly marked):**
- Label-entry guards (before LABEL): validate/transform data at creation time
- Guard composition rules (operation guard specific vs label guard specific)
- Privileged guards, label modification

**Key changes:**
- security-getting-started.md: rewrite intro with prompt injection example as the lead
- before-guards.md: split into two atoms or clearly separate the two patterns
- guard-composition.md: qualify which rules apply to which guard type
- denied-handlers.md: present in the core path (operation guards), note inapplicability to label-entry guards only in the advanced section

## Evidence
- QA run: qa/runs/2026-02-16-0/
- security-before-guards: 2/10 pass rate (worst topic)
- security-guard-composition: 2/12 pass rate
- Self-reviews confirmed: agents testing label guards expecting operation guard behavior

