---
id: m-a372
status: closed
deps: []
created: 2026-02-13T16:22:52Z
type: feature
priority: 1
assignee: Adam
updated: 2026-02-13T16:44:39Z
---
# Add @el.mx.index for array iteration index metadata

During `for` iteration over arrays, each element should gain `@el.mx.index` (zero-based integer), mirroring how object iteration has `@v.mx.key`.

## Syntax

```mlld
var @arr = ["a", "b", "c"]
for @el in @arr => show \`@el.mx.index: @el\`
>> 0: a
>> 1: b
>> 2: c
```

## Semantics

- `@el.mx.index` is a zero-based integer reflecting position in the original array
- Available anywhere the iteration variable is referenced within the loop body (expressions, when blocks, templates, nested loops)
- `for parallel` preserves original array index regardless of execution order
- Each nested loop's variable has its own independent `mx.index`
- Object iteration: `@v.mx.index` is not set (objects are unordered, use `@v.mx.key`)
- Works on primitives in arrays (metadata attaches to the iteration binding, not the value's type)

## Two-binding form

NOT in scope. No `for @el, @i in @arr` — metadata only (`@el.mx.index`). Two-binding on arrays should be a separate future decision or an error.

## Edge cases

- Empty array: no iterations, no change
- Single element: `@el.mx.index` is 0
- Nested for: each loop variable has its own independent `mx.index`
- Object iteration: `@v.mx.index` is undefined/not set

## Motivating example

Updating specific array entries by index — currently requires `js {}` blocks. With `mx.index`, can be done natively:

```mlld
exe @applyFlags(stance, flags) = [
  let @entries = @stance.entries ?? []
  let @updated = for @e in @entries => [
    let @match = for @f in @flags when @f.entry_index == @e.mx.index => @f.review_flag
    => when @match.length [
      0 => @e
      * => { ...@e, "review_flag": @match[0] }
    ]
  ]
  => { ...@stance, "entries": @updated }
]
```

## Acceptance Criteria

1. `@el.mx.index` returns zero-based index during array `for` iteration
2. Works in expressions, when blocks, templates, and nested loops
3. `for parallel` preserves original array indices
4. `@v.mx.index` is not set during object iteration
5. Works on primitive values in arrays


**2026-02-13 16:44 UTC:** Implemented array for-loop mx.index metadata with characterization coverage; full npm test passed. Commit: 8c2b823be
