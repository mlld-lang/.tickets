---
id: m-56a0
status: open
deps: [m-14ff]
created: 2026-02-18T17:12:20Z
type: task
priority: 2
assignee: Adam Avenir
updated: 2026-02-18T17:12:20Z
---
# Phase 5: Migrate MemoryFileSystem and harness to VirtualFS parity

Context:
- Source plan: plan-virtualfs.md (Phase 5)

Goal:
Migrate test infrastructure from MemoryFileSystem semantics to VirtualFS-backed semantics while preserving harness reliability.

Implementation tasks:
- Convert tests/utils/MemoryFileSystem.ts into:
  - compatibility wrapper around VirtualFS.empty(), or
  - direct deprecation path with migrations (per contract decision).
- Preserve test-only helper capabilities needed by existing suites.
- Migrate high-impact suites first (fixture harness/sdk/core), then broader replacements.
- Ensure no hidden behavioral drift in fixture file copy/load workflows.

## Design

Integration anchors:
- tests/utils/MemoryFileSystem.ts
- interpreter/interpreter.fixture.test.ts
- sdk/*.test.ts
- core/services/PathContextService.test.ts

Risk focus:
- fixture harness path normalization and directory traversal behavior,
- API compatibility for methods used outside IFileSystemService (if any test helpers rely on them).

## Acceptance Criteria

Exit criteria:
- Added test coverage:
  - Add tests/utils/MemoryFileSystem.parity.test.ts validating compatibility behavior.
  - Ensure fixture harness regression coverage remains green.
- All tests pass:
  - full regression gate.
- Docs updates:
  - Update docs/dev/TESTS.md to reflect VirtualFS-based test environment/harness behavior.
  - Update CHANGELOG.md for migration changes.
- Commit made:
  - Commit with message: refactor(tests): migrate MemoryFileSystem usage onto VirtualFS

