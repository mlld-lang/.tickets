---
id: m-2586
status: open
deps: []
created: 2026-02-18T17:12:19Z
type: task
priority: 2
assignee: Adam Avenir
---
# Phase 0: VirtualFS contract freeze and baseline

Context:
- Source plan: plan-virtualfs.md (Phase 0)
- Vision/spec: vision-virtualfs.md, spec-virtualfs.md
- References: docs/dev/ARCHITECTURE.md, docs/dev/GRAMMAR.md, docs/dev/TESTS.md, docs/dev/SDK.md, docs/user/sdk.md

Goal:
Lock all VirtualFS public contracts and migration decisions before implementation to prevent downstream churn.

Required decisions to finalize in this ticket:
1) Public import path contract for VirtualFS (root export vs subpath export, or both).
2) Inspection API naming contract (changes() vs diff() alias behavior).
3) VirtualFS.over(...) signature contract (IFileSystemService only vs convenience overload).
4) MemoryFileSystem migration strategy (wrapper-first vs immediate replacement).

Implementation tasks:
- Add/update a concise design note capturing these decisions and rationale.
- Define canonical behavior requirements for:
  - ENOENT shape (code/path),
  - path normalization,
  - shadow precedence,
  - delete masking and directory visibility.
- Ensure this contract is reflected in plan-virtualfs.md and implementation notes for downstream phases.

## Design

Scope anchor files:
- services/fs/IFileSystemService.ts
- services/fs/NodeFileSystem.ts
- tests/utils/MemoryFileSystem.ts
- sdk/index.ts
- package.json (exports)

Non-goals:
- Do not implement VirtualFS code in this ticket.
- Do not migrate tests yet.

Quality guardrails:
- Decisions must be explicit and executable (no ambiguous language).
- Each resolved decision must point to affected files and future phase owners.

## Acceptance Criteria

Exit criteria:
- Added test coverage:
  - Add/update a baseline test checklist artifact that names mandatory regression suites for all VirtualFS phases.
- All tests pass:
  - npm run build:fixtures
  - npm test
  - npm run test:tokens
  - npm run test:heredoc
  - npm run build
- Docs updates:
  - Update plan-virtualfs.md (and/or linked design note) with finalized contracts.
  - Add CHANGELOG.md entry for contract freeze kickoff.
- Commit made:
  - Commit with message: chore(vfs): lock VirtualFS public contract and migration policy

