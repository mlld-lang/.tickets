---
id: m-8445
status: closed
deps: []
created: 2026-02-09T08:41:30Z
type: bug
priority: 2
assignee: Adam Avenir
updated: 2026-02-09T22:53:15Z
---
# After-guard allow-with-warning doesn't emit to stderr

tests/cases/feat/security/guard-after-deny-unhandled: Guard fires correctly but allow-decision warnings not emitted to stderr. After-guard path needs env.emitEffect('stderr', ...) call.


**2026-02-09 22:53 UTC:** Fixed after-guard warning emission path. Preserved '[Guard Warning]' stderr effects across guard-retry buffering on terminal errors, added missing GuardError import in exec invocation fallback, and extended fixture error-shape validation to include timing/outputPreview so expected-error assertions pass. Verified with: npx vitest run interpreter/interpreter.fixture.test.ts -t "guard-after-deny-unhandled" and npx vitest run tests/interpreter/hooks/guard-retry-runner.test.ts tests/interpreter/hooks/guard-post-hook.test.ts tests/interpreter/guard-denied-handlers.test.ts.
