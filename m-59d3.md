---
id: m-59d3
status: closed
deps: []
created: 2026-02-09T19:20:46Z
type: feature
priority: 0
assignee: Adam
updated: 2026-02-12T13:48:05Z
---
# Remove command/code execution from show directive

Remove the showCommand and showCode subtypes from the /show directive. These subtypes duplicate /run's job (executing shell commands and code blocks) but without run's security safeguards (command analysis, policy enforcement, taint tracking, label flow checks, stdin handling, streaming, working directory resolution, large payload detection, using clause/environment injection).

Keep all other show subtypes: showVariable, showTemplate, showPath, showPathSection, showLoadContent, showForeach, showForeachSection, showInvocation. These are expression evaluation / content display and go through proper exec infrastructure.

After this change, show becomes 'evaluate and print' — variables, templates, files, @func() calls. run becomes the only way to execute shell commands and code blocks.

## Design

Grammar: Remove the two showCommand and showCode alternatives from grammar/directives/show.peggy (lines 36-138). Add error recovery rules that suggest using /run instead.

Evaluator: Remove showCommand and showCode cases from interpreter/eval/show.ts (lines 1078-1159).

The remaining show subtypes are unaffected:
- showVariable, showTemplate, showPath, showPathSection — pure display
- showLoadContent — file loading
- showForeach, showForeachSection — iteration display
- showInvocation — goes through resolveDirectiveExecInvocation (has security)

## Acceptance Criteria

1. show {cmd} and show lang {code} produce a parse error with a helpful message suggesting /run
2. All other show subtypes work unchanged
3. show @func() still works (invocation path is preserved)
4. show ::template with @func():: still works (interpolation path is preserved)
5. No security regressions — command/code execution only available through /run
6. Documentation updated to reflect the change
7. Test cases updated


**2026-02-09 19:26 UTC:** ## Audit Results

### Docs (1 file)
- docs/llm/llms-core-rules.txt (lines 44, 50) — documents show+run pattern, needs rewriting

### Tests (4 test cases, 6 files)

Template-inline tests (literal text, not execution — review whether they're affected):
- tests/cases/feat/template-inline/inline-show-double-bracket/ (example.md + expected.md)
- tests/cases/feat/template-inline/inline-show-triple/ (example.md + expected.md)

Import exception tests (show {{var}} accidentally parses as showCommand — fix to show @var):
- tests/cases/exceptions/imports/missing-export/example.md
- tests/cases/exceptions/imports/alias-collision/example.md

Auto-generated (rebuild after changes):
- tests/cases/EXAMPLES.md
- Related .generated-fixture.json files in tests/fixtures/

**2026-02-09 20:03 UTC:** ## Additional Scope: Inline Template Paths

Removal also applies to inline template /show {cmd} and /show js {code} forms in TemplateInlineShow (grammar/base/unified-templates.peggy) and the corresponding evaluation path in interpreter/utils/interpolation.ts. Same security reasoning — inline show should not bypass run's security infrastructure.

Also: add defensive runtime errors in evaluateShow for showCommand/showCode subtypes. If legacy AST somehow reaches the evaluator, throw a clear error rather than silently failing.

**2026-02-09 20:19 UTC:** Implementation plan (stability-first): 1) Grammar: remove showCommand/showCode branches from grammar/directives/show.peggy and add explicit parse errors directing users to /run for /show {..} and /show <lang> {..}. 2) Inline templates: remove command/code forms from TemplateInlineShow (grammar/base/unified-templates.peggy) and related interpolation synthesis paths so inline /show cannot execute code/commands. 3) Evaluator: remove showCommand/showCode execution paths in interpreter/eval/show.ts; keep defensive runtime error if legacy AST subtype appears. 4) Update dependent rendering/helpers (e.g., sign-verify inline show serializer) to avoid command/code variants. 5) Tests/docs: fix exceptions/imports cases to use show @var (not show {{var}}), update docs/llm/llms-core-rules.txt and any references implying show executes commands/code, regenerate fixtures, run targeted tests then full npm test.
