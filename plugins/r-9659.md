---
id: r-9659
status: closed
deps: []
created: 2026-02-22T00:31:32Z
type: feature
priority: 0
assignee: Adam
tags: [marketplace, registry, publish]
updated: 2026-02-22T00:48:05Z
---
# Verify publish pipeline for skill/command modules

Verify and fix the end-to-end publish flow for skill and command directory modules. The registry build script now generates marketplace.json from entries with type: skill or type: command, but no skill modules have been published yet to validate the full pipeline.

## Design

RepoPublishingStrategy.createDirectoryRegistryEntry() already sets type: manifest.type (line 302), so the type field should propagate into the version .json. Verify this works by:

1. Create a test skill module with `mlld module skill test-pub`
2. Run `mlld publish --dry-run` to inspect the generated registry entry
3. Confirm the version .json includes `type: 'skill'` and `source.repository.path`
4. Confirm the build script picks it up and generates a marketplace entry

If type is missing or wrong, fix createDirectoryRegistryEntry(). Also check that ModuleReader.readDirectoryModule() correctly handles the new .claude-plugin/ directory in skill modules (it should already be included in the file list since it's not in the exclusion list).

Key files:
- cli/commands/publish/strategies/RepoPublishingStrategy.ts (line 282-327)
- cli/commands/publish/utils/ModuleReader.ts (readDirectoryModule, validateManifest)
- registry/tools/build-registry.js (buildMarketplace function)

## Acceptance Criteria

- [ ] `mlld publish --dry-run` on a skill module produces a version .json with `type: 'skill'`
- [ ] source.repository.path is set correctly for the skill's location
- [ ] .claude-plugin/plugin.json is included in source.files list
- [ ] skills/{name}/SKILL.md is included in source.files list
- [ ] build-registry.js generates a marketplace entry from the published skill data
- [ ] Existing library module publishing is unaffected


**2026-02-22 00:48 UTC:** Fixed two publish pipeline bugs: ModuleReader skips AST parsing for non-.mld entries; ExportValidator skips for skill/command types.
