---
id: m-3343
status: open
deps: []
created: 2026-02-15T06:58:29Z
type: bug
priority: 1
assignee: Adam
tags: [runtime, structured-value, chain-functions]
updated: 2026-02-15T06:58:33Z
---
# includes() fails on StructuredValue properties in for-when clauses

Array.includes() returns false when called with a StructuredValue property accessor (e.g. @s.topic) inside a for-when filter, even when the value matches. Equality comparison (==) works correctly. Extracting the property to a plain variable first also works.

Minimal reproduction:
  var @s1 = <file.json>   // contains {topic: "append"}
  var @list = ["append"]
  // FAILS: returns []
  var @r1 = for @s in [@s1] when @list.includes(@s.topic) => @s.topic
  // WORKS: returns ["append"]  
  var @extracted = for @s in [@s1] => @s.topic
  var @r2 = for @t in @extracted when @list.includes(@t) => @t

Investigation scope:
- All chain functions on StructuredValue properties (.includes, .startsWith, .endsWith, .indexOf, etc.)
- All block types (for-when, for-block, exe, when-list)
- Nested property chains (@var.item.thing.includes())
- Both glob-loaded and single-file-loaded StructuredValues

## Acceptance Criteria

1. @list.includes(@s.property) works identically to extracting to let then calling includes
2. All chain functions (includes, startsWith, endsWith, indexOf, etc.) work on StructuredValue properties
3. Nested chains like @var.item.thing.includes() work
4. Works in all block contexts (for-when, for-block, exe blocks, when-list)

