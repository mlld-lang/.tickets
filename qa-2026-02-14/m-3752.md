---
id: m-3752
status: closed
deps: []
created: 2026-02-15T08:10:08Z
type: bug
priority: 1
assignee: Adam
tags: [qa-2026-02-14, p1, guards]
updated: 2026-02-15T09:46:36Z
---
# Denied handlers produce wrong result inside for loops

In a for loop context, untrusted input shows 'deleted' instead of 'blocked' even though the guard warning appears.

QA topic: security-denied-handlers

## Acceptance Criteria

Denied handlers return consistent results inside and outside for loops


**2026-02-15 09:46 UTC:** --dir qa-2026-02-14 Fixed denied-handler inconsistency in /for loops by propagating source security descriptors into iteration bindings so denied fallback behavior matches non-loop execution. Added regression coverage in tests/interpreter/guard-denied-handlers.test.ts and validated with full npm test (4154 passed, 60 skipped).

**2026-02-15 09:46 UTC:** Fixed denied-handler inconsistency in /for loops by propagating source security descriptors into iteration bindings so denied fallback behavior matches non-loop execution. Added regression coverage in tests/interpreter/guard-denied-handlers.test.ts and validated with full npm test (4154 passed, 60 skipped). --dir qa-2026-02-14

**2026-02-15 09:46 UTC:** Regression fix verified: denied guard handlers now return consistent fallback values inside and outside /for loops; full npm test passed.
