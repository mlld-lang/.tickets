---
id: m-285c
status: closed
deps: []
links: []
created: 2026-01-29T01:05:30Z
type: bug
priority: 1
parent: 
assignee: Adam
tags: [grammar, env, executor, assignments, impl-partial]
updated: 2026-01-31T08:15:32Z
---
# Extend grammar to allow env and executor path overrides as RHS in variable assignments

The interpreter already supports it, the grammar restriction is an oversight. 'var @result = env @config [...]' and 'var @x = run sh:/path {...}' should work. Human answer from QA strategy question 3.


**2026-01-30 12:37 UTC:** Partial implementation: executor path override works (var @x = run sh:/bin/bash {...}), but env override syntax does not (var @result = env {...} sh {...}).

**2026-01-30 15:17 UTC:** Enrich reviewed: 2026-01-30T15:14:56.295Z

**2026-01-31 08:15 UTC:** Fixed working directory override for var RHS code execution. The grammar was already parsing `sh:/path` as workingDir metadata, but the interpreter's evaluateCodeExecution function wasn't passing the workingDir to env.executeCode. Fixed by:

1. Updated CodeExecutionNode interface to include workingDir and meta fields
2. Updated evaluateCodeExecution to call resolveWorkingDirectory and pass workingDir to env.executeCode
3. Updated var.ts to pass source location to evaluateCodeExecution

Now `var @cwd = run sh:/tmp { pwd }` correctly executes in /tmp.

Note: The ticket mention of 'env override syntax (var @result = env {...} sh {...})' appears to be a misunderstanding - that syntax isn't documented or valid. The documented syntax `var @result = env @config [...]` already parses correctly but env blocks returning values may need separate investigation.

**2026-01-31 08:15 UTC:** Fixed working directory override for var RHS code execution. The grammar was already parsing sh:/path as workingDir metadata, but the interpreter evaluateCodeExecution function was not passing the workingDir to env.executeCode. Fixed by:

1. Updated CodeExecutionNode interface to include workingDir and meta fields
2. Updated evaluateCodeExecution to call resolveWorkingDirectory and pass workingDir to env.executeCode  
3. Updated var.ts to pass source location to evaluateCodeExecution

Now var @cwd = run sh:/tmp { pwd } correctly executes in /tmp.

Note: The ticket mention of 'env override syntax (var @result = env {...} sh {...})' appears to be a misunderstanding - that syntax is not documented or valid. The documented syntax var @result = env @config [...] already parses correctly but env blocks returning values may need separate investigation.
