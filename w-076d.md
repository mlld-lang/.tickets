---
id: w-076d
status: closed
deps: []
created: 2026-02-20T23:52:59Z
type: bug
priority: 1
assignee: Adam
updated: 2026-02-21T00:55:16Z
---
# hook and checkpoint directives fail validation in strict mode

Both `hook` and `checkpoint` directives are in the grammar (grammar/mlld.peggy lines 245, 254) and parse correctly in markdown mode (.md with / prefix), but fail in strict mode (.mld) with 'Text content not allowed in strict mode'. Affects both the MCP validator tool and the CLI `mlld validate`. The directives work at runtime (test fixtures in markdown mode pass), but strict-mode validation rejects them.

## Acceptance Criteria

- `hook @name after @fn = [...]]` validates in .mld files
- `checkpoint "name"` validates in .mld files
- MCP validate tool and CLI `mlld validate` both accept these directives in strict mode


**2026-02-21 00:55 UTC:** Verified on current code: strict-mode bare hook/checkpoint already parse in CLI and MCP validate paths. Added regression tests in grammar/tests/hook.test.ts, grammar/tests/checkpoint.test.ts, and cli/mcp/BuiltinTools.test.ts to lock behavior; targeted vitest suite passes (44 tests).
