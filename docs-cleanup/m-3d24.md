---
id: m-3d24
status: closed
deps: []
created: 2026-02-17T23:13:04Z
type: task
priority: 2
assignee: Adam Avenir
updated: 2026-02-18T07:18:55Z
---
# Fold INTERPRETER-CORE-EXTRACTION-MAP.md into INTERPRETER.md

Integrate useful interpreter extraction-map guidance into docs/dev/INTERPRETER.md.

## Acceptance Criteria

- docs/dev/INTERPRETER.md includes any still-relevant extraction-map details.\n- docs/dev/INTERPRETER-CORE-EXTRACTION-MAP.md is ready for deletion by the remove ticket.


**2026-02-17 23:37 UTC:** Doc-audit input (source: `llm/run/doc-audit/tmp/results.json`) for this ticket.
This input MUST be verified with 100% confidence during implementation.

Files in scope to verify:
- `docs/dev/INTERPRETER.md` [mostly-current]: Core architecture is accurately described; Quick Map is missing several directives (bail, env, loop) and misidentifies /log's output destination as stdout instead of stderr

Verification bar (required):
- Confirm or disprove each finding for the files above against current code/docs with 100% confidence.
- If disproved, record why with concrete file references.
- If confirmed, update docs in this ticket scope and keep links/frontmatter consistent.

**2026-02-17 23:50 UTC:** Verified against current code/docs (100% confidence). Decisive update list:

- `docs/dev/INTERPRETER.md`
  - In `Quick Map`, add missing directive entries that are implemented and dispatched today:
    - `/bail` -> `interpreter/eval/bail.ts` (`evaluateBail`, wired in `interpreter/eval/directive.ts`).
    - `/env` -> `interpreter/eval/env.ts` (`evaluateEnv`, wired in `interpreter/eval/directive.ts`).
    - `/loop` -> `interpreter/eval/loop.ts` (`evaluateLoopDirective` + `evaluateLoopExpression`, routed in `interpreter/eval/directive.ts` and `interpreter/core/interpreter/evaluator.ts`).
  - Correct the `/log` Quick Map description: it does **not** write to stdout.
    - `/log` directive sugar targets `stderr` (see `grammar/directives/output.peggy`, `SlashLog` building `target.stream: 'stderr'`).
    - Pipeline inline effect `| log` emits `env.emitEffect('stderr', ...)` (see `interpreter/eval/pipeline/builtin-effects.ts`).
  - Fold in still-relevant extraction-map guidance as a short “core extraction seams” subsection (do not duplicate verbatim):
    - Entry-point contract and ownership around `evaluate`, `interpolate`, `cleanNamespaceForDisplay` (`interpreter/core/interpreter.ts`).
    - Module responsibilities for `traversal.ts`, `dispatch.ts`, `resolve-variable-reference.ts`, `interpolation-security.ts`, `value-resolution.ts`, `namespace-display.ts`.
    - Keep the unknown-node invariant (`Unknown node type: <type>`) aligned with `interpreter/core/interpreter/dispatch.ts`.
    - Reference characterization coverage in `interpreter/core/interpreter.characterization.test.ts`.

- `docs/dev/INTERPRETER-CORE-EXTRACTION-MAP.md`
  - After the merge above, this file is ready for deletion (its verified guidance is covered by `INTERPRETER.md`).

- Confirmed/disproved audit findings for this ticket:
  - Confirmed: Quick Map is missing `/bail`, `/env`, `/loop`.
  - Confirmed: Quick Map currently misstates `/log` destination as stdout; code routes log output to stderr.
