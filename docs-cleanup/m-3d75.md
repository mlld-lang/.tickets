---
id: m-3d75
status: closed
deps: []
created: 2026-02-17T23:13:04Z
type: task
priority: 2
assignee: Adam Avenir
updated: 2026-02-18T07:20:10Z
---
# Fold CTX-TO-MX-MIGRATION-PLAYBOOK.md into INTERPRETER.md and DATA.md

Move current-state ctx->mx architecture notes from docs/dev/CTX-TO-MX-MIGRATION-PLAYBOOK.md into canonical runtime docs.

## Acceptance Criteria

- Current-state mx semantics live in docs/dev/INTERPRETER.md and/or docs/dev/DATA.md.\n- Migration-playbook procedural content is not duplicated in canonical docs.\n- docs/dev/CTX-TO-MX-MIGRATION-PLAYBOOK.md is ready for deletion by the remove ticket.


**2026-02-17 23:37 UTC:** Doc-audit input (source: `llm/run/doc-audit/tmp/results.json`) for this ticket.
This input MUST be verified with 100% confidence during implementation.

Files in scope to verify:
- `docs/dev/INTERPRETER.md` [mostly-current]: Core architecture is accurately described; Quick Map is missing several directives (bail, env, loop) and misidentifies /log's output destination as stdout instead of stderr
- `docs/dev/DATA.md` [mostly-current]: Largely accurate; two medium-severity issues: incorrect file path/line reference for show.ts:630 (file is only 158 lines; pattern lives in show/show-invocation-handlers.ts:56), and the Pipelines section misattributes structuredOutputs/previousOutputs to PipelineExecutor when they actually live in state-machine.ts context building.

Verification bar (required):
- Confirm or disprove each finding for the files above against current code/docs with 100% confidence.
- If disproved, record why with concrete file references.
- If confirmed, update docs in this ticket scope and keep links/frontmatter consistent.

**2026-02-17 23:52 UTC:** Verified against current code/docs (100% confidence). Decisive update list:

- `docs/dev/INTERPRETER.md`
  - Carry forward the confirmed Quick Map fixes from current code:
    - Add missing directive entries for `/bail` (`interpreter/eval/bail.ts`), `/env` (`interpreter/eval/env.ts`), and `/loop` (`interpreter/eval/loop.ts`).
    - Correct `/log` behavior to stderr (not stdout):
      - `/log` directive sugar builds `target.stream: 'stderr'` in `grammar/directives/output.peggy`.
      - Pipeline `| log` emits `env.emitEffect('stderr', ...)` in `interpreter/eval/pipeline/builtin-effects.ts`.
  - Fold only current-state mx semantics from the playbook (not migration procedure):
    - Clarify ambient `@mx` is runtime execution context built by `ContextManager.buildAmbientContext()` (`interpreter/env/ContextManager.ts`).
    - Clarify `@mx` is reserved and cannot be user-defined (`interpreter/env/VariableManager.ts` throws on `name === 'mx'`).
    - Keep/strengthen pointer that `.mx` value metadata lives in `docs/dev/DATA.md` (distinct from ambient `@mx`).

- `docs/dev/DATA.md`
  - Fix incorrect code reference in “Use `asText()` at display boundaries” example:
    - Replace `interpreter/eval/show.ts:630` (invalid; file is 158 lines) with the real nested-wrapper conversion site in `interpreter/eval/show/show-invocation-handlers.ts` (`toInvocationDisplayValue`, currently line ~56).
  - Correct pipeline ownership wording in “Where Values Flow → Pipelines”:
    - Do not attribute `previousOutputs` / `structuredOutputs` context assembly to `PipelineExecutor`.
    - Document accurately that stage context fields are assembled in `PipelineStateMachine.buildStageContext()` (`interpreter/eval/pipeline/state-machine.ts`).
    - If mentioning executor ownership, scope it to stage output normalization/caching (`PipelineOutputProcessor` + `StageOutputCache`).
  - Add a concise contrast section: ambient `@mx` (execution context) vs wrapper/variable `.mx` (value metadata), aligned with `ContextManager` + StructuredValue/Variable docs.

- `docs/dev/CTX-TO-MX-MIGRATION-PLAYBOOK.md`
  - After the canonical docs absorb the runtime semantics above, this playbook is ready for deletion.

- Explicitly do NOT migrate into canonical docs:
  - Branch/test/checklist steps, global find/replace commands, rollback commands, commit template text, and one-time migration mechanics.
