---
id: m-4a89
status: closed
deps: []
created: 2026-02-17T23:13:04Z
type: task
priority: 2
assignee: Adam Avenir
updated: 2026-02-18T07:23:52Z
---
# Fold PARALLEL-PIPELINE-PLAN.md into PIPELINE.md

Merge relevant parallel pipeline architecture guidance into docs/dev/PIPELINE.md.

## Acceptance Criteria

- Parallel pipeline behavior is documented in docs/dev/PIPELINE.md.\n- Plan-only or stale wording removed.\n- docs/dev/PARALLEL-PIPELINE-PLAN.md is ready for deletion by the remove ticket.


**2026-02-17 23:37 UTC:** Doc-audit input (source: `llm/run/doc-audit/tmp/results.json`) for this ticket.
This input MUST be verified with 100% confidence during implementation.

Files in scope to verify:
- `docs/dev/PIPELINE.md` [outdated]: Multiple interface signatures are wrong (RetryContext.allAttempts and PipelineState.allRetryHistory use StructuredValue[] not string[]), grammar file path is incorrect, old @exec/@data/@text directive syntax appears in examples, and the Available Transformers list is incomplete.

Verification bar (required):
- Confirm or disprove each finding for the files above against current code/docs with 100% confidence.
- If disproved, record why with concrete file references.
- If confirmed, update docs in this ticket scope and keep links/frontmatter consistent.

**2026-02-17 23:55 UTC:** Verified against current code/docs (100% confidence). Decisive update list:

- `docs/dev/PIPELINE.md`
  - Keep parallel pipeline behavior as current-state architecture (not plan/future tense), aligned with runtime code:
    - Leading parallel groups (`|| @a() || @b() ...`) are supported via grammar (`grammar/patterns/tail-modifiers.peggy`) and executed by `PipelineParallelStageRunner`.
    - Concurrency cap + pacing are supported through shorthand `(<cap>, <delay>)` / `(<cap>)` (`PipelineParallelSpec` in `grammar/patterns/directive-ending.peggy`) and with-clause options (`parallel`, `delay` -> `delayMs` in `grammar/patterns/with-clause.peggy`).
    - Branch outputs are aggregated in declaration order; parallel failures become marker objects and are exposed in parallel error context (`interpreter/eval/pipeline/executor/parallel-stage-runner.ts`, helper context updates).
    - `retry` is rejected inside parallel stages (`parallel-stage-runner.ts` returns error when any branch emits retry).
    - Default concurrency falls back to `MLLD_PARALLEL_LIMIT` or `4` (`interpreter/utils/parallel.ts`).
  - Remove stale plan/task/future wording:
    - Replace or remove examples labeled as future work (e.g., “Future parallel execution”).
    - Remove checklist-style planning language if present; keep only behavior that exists today.
  - Apply confirmed PIPELINE audit fixes in this ticket scope:
    - Correct retry interface signatures: `RetryContext.allAttempts` and `PipelineState.allRetryHistory` use `StructuredValue[]`.
    - Fix outdated grammar/file map entries (e.g., non-existent `grammar/directives/data.peggy`).
    - Replace examples that use removed directive forms (`@exec`, `@data`, `@text`) with current syntax.
    - Expand/refresh “Available Transformers” to match current built-ins.

- `docs/dev/PARALLEL-PIPELINE-PLAN.md`
  - After the above is merged into `PIPELINE.md`, this plan doc is ready for deletion.

- Do NOT carry into canonical docs:
  - Goal/task/checklist language from the plan.
  - Any wording that implies features are pending when they are already implemented.
