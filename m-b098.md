---
id: m-b098
status: closed
deps: [mlld-794g]
links: []
created: 2026-01-24T04:45:03Z
type: task
priority: 2
assignee: Adam Avenir
parent: mlld-4z2w
---
# Phase 4a: @mx.tools namespace

## Goal

Implement `@mx.tools.*` namespace for tool call observability per spec Part 1.9.

## Context

The security spec promises:
```mlld
@mx.tools.calls      // Array of tool calls made this turn
@mx.tools.allowed    // Tools the LLM is permitted to use
@mx.tools.denied     // Tools explicitly denied
```

This enables guards to make decisions based on what tools have been called.

## Integration Points

1. **FunctionRouter**: Track calls in session context
2. **MCPServer**: Expose allowed/denied based on tool collection
3. **Guard context**: `@mx.tools.*` available in guard conditions

## Exit Criteria

- [ ] `@mx.tools.calls` populated after each tool call
- [ ] `@mx.tools.allowed` reflects current tool collection
- [ ] `@mx.tools.denied` reflects filtered-out tools
- [ ] Guards can reference `@mx.tools.*` in conditions
- [ ] Test: guard uses `@mx.tools.calls` to limit call frequency

## Estimated Effort
~4 hours

## Depends On
mlld-794g (tool filtering - need tool collection runtime)

