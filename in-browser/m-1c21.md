---
id: m-1c21
status: open
deps: [m-4390]
created: 2026-02-18T17:16:46Z
type: epic
priority: 1
assignee: Adam Avenir
updated: 2026-02-18T17:18:25Z
---
# Phase 1: Browser-safe core primitives

## Goal
Remove Node-only blockers in shared primitives and establish browser-safe path, hashing, and JS executor baseline behavior.

## Context and references
- Planning source: `plan-in-browser.md` (Phase 1).
- Related architecture guidance: `docs/dev/ARCHITECTURE.md`.
- Test strategy guidance: `docs/dev/TESTS.md`.
- Primary integration targets:
  - `services/fs/IPathService.ts`
  - `services/fs/PathService.ts`
  - `services/fs/BrowserPathService.ts` (new)
  - `core/registry/InMemoryModuleCache.ts`
  - `interpreter/env/executors/JavaScriptExecutor.ts`

## Required implementation
1. Add `BrowserPathService` implementing `IPathService` with browser-safe POSIX semantics.
2. Refactor `InMemoryModuleCache` to avoid Node-only `crypto`/`Buffer` usage while preserving deterministic hashes.
3. Guard JS executor cwd mutation behavior so browser profile never depends on `process.cwd()`/`process.chdir()`.
4. Preserve existing Node runtime behavior for server/CLI paths.

## Required test coverage
1. Add `services/fs/BrowserPathService.test.ts` covering resolve/join/dirname/basename/normalize and URL handling.
2. Extend `core/registry/InMemoryModuleCache.test.ts` for deterministic hash and size-accounting parity.
3. Extend `interpreter/env/executors/JavaScriptExecutor.test.ts` for process/cwd guard paths.
4. Run all touched test suites and verify pass status.

## Required docs and changelog updates
1. Update `docs/dev/ARCHITECTURE.md` with browser path/cache primitive behavior.
2. Update `CHANGELOG.md` with Added/Fixed entries for browser-safe primitives and JS executor guard behavior.

## Commit requirement
- Commit only after tests are green.
- Commit message must be:
  - `feat(browser): add browser-safe path and cache primitives`

## Exit criteria
1. Browser-safe path/cache primitives are implemented and wired.
2. New and updated tests are present and passing.
3. No direct Node-only APIs remain in the targeted primitive path for browser runtime.
4. Required docs and `CHANGELOG.md` updates are completed.
5. Required phase commit exists and references the completed test run.
