---
id: m-4390
status: closed
deps: []
created: 2026-02-18T17:16:16Z
type: epic
priority: 1
assignee: Adam Avenir
updated: 2026-02-27T04:51:37Z
---
# Phase 0: CLI unification contract (`--ephemeral` and `--ci`)

## Goal
Establish the canonical CLI/runtime contract so ephemeral and CI execution are handled by `mlld --ephemeral` and `mlld --ci`, and remove the separate `mlldx` wrapper/package surface.

## Context and references
- Planning source: `plan-in-browser.md` (Phase 0).
- Product scope: `vision-in-browser.md`, `spec-in-browser.md`.
- Reference docs: `docs/dev/ARCHITECTURE.md`, `docs/dev/TESTS.md`.
- Legacy paths to migrate from:
  - `bin/mlldx-wrapper.cjs`
  - `mlldx-package/package.json`
  - `scripts/sync-mlldx.cjs`
  - `scripts/publish-with-mlldx.cjs`

## Required implementation
1. Implement explicit `--ephemeral` and `--ci` behavior in the main `mlld` CLI path.
2. Remove or decommission separate `mlldx` command/package entrypoints, with clear migration behavior.
3. Preserve expected ephemeral behavior and define CI policy defaults (including import-approval behavior).
4. Ensure naming is coherent across runtime, packaging, and docs.

## Required test coverage
1. Add CLI contract tests for:
   - `--ephemeral` behavior parity.
   - `--ci` behavior contract.
   - deprecation/removal path for legacy `mlldx` entrypoints.
2. Run all tests touched by this phase and confirm they pass.
3. Run at least one regression command that proves non-ephemeral CLI behavior was not broken.

## Required docs and changelog updates
1. Update `docs/dev/MLLDX.md` with decommissioning and migration guidance.
2. Update `docs/user/cli.md` with the unified CLI contract and examples.
3. Update `CHANGELOG.md` with entries for unified CLI behavior and migration docs.

## Commit requirement
- Commit only after tests are green.
- Commit message must be:
  - `chore(cli): define unified ephemeral/ci mode contract`

## Exit criteria
1. Code implements unified CLI behavior with no separate `mlldx` runtime surface.
2. New/updated CLI tests exist and pass.
3. All tests run for this phase pass locally.
4. Required docs and `CHANGELOG.md` are updated and consistent.
5. Required phase commit exists and references the completed test run.
