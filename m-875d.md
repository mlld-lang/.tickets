---
id: m-875d
status: open
deps: []
created: 2026-02-02T22:16:04Z
type: task
priority: 2
assignee: Adam
---
# Educational error messages for if/when - audit and improve all errors

## Summary

Audit all `if` and `when` related parse/runtime errors and make them educational. Error messages for agents are often more effective than documentation because they arrive at the exact moment of confusion.

## Current State

The error "Use 'if' for imperative blocks, not 'when'" is helpful but could be more comprehensive. Other if/when errors may be less clear.

## Proposed Pattern

Each if/when error should include:

1. **What went wrong** (current)
2. **The mental model** - "when for values, if for flow"
3. **Quick reference of valid forms** showing what IS allowed
4. **The specific fix** for this case

## Example Improved Error

```
Parse error: Use 'if' for imperative blocks, not 'when'.

Mental model: 'when' returns values, 'if' controls flow.

Valid forms:
  when [@cond => value; * => default]     Expression - returns value
  when @subject ["a" => x; "b" => y]     Pattern match - returns value  
  if @cond [actions]                       Imperative - executes actions
  if @cond => action                       Simple conditional action

Your code:
  when @decision.action ["work" => show ...]
  
Fix: This is pattern matching with action blocks. Either:
  1. Assign the result: var @x = when @decision.action [...]
  2. Use inside a block context (loop, exe body)
  3. Convert to if chain: if @decision.action == "work" [...]
```

## Scope

Audit these error sites:
- grammar/directives/when.peggy - parse errors
- grammar/directives/if.peggy - parse errors  
- interpreter/eval/when.ts - runtime errors
- interpreter/eval/when-expression.ts - runtime errors
- interpreter/eval/if.ts - runtime errors
- core/errors/patterns/parse-errors.generated.js - error templates

## Why This Matters

LLMs hit if/when confusion constantly. Educational errors that explain the mental model at the moment of error are more effective than documentation that may not be loaded in context.

## Related

- m-c065 (LLM pitfalls docs) - complementary, docs for prevention
- todo/done-DESIGN-IF-WHEN.md - the design spec to reference

