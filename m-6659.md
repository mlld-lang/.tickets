---
id: m-6659
status: closed
deps: []
created: 2026-02-24T20:45:48Z
type: bug
priority: 0
assignee: Adam Avenir
updated: 2026-02-25T00:57:15Z
---
# Registry: fix update to respect pinned versions + failed install lock file corruption

## Bug 1: Failed installs corrupt the lock file

When a versioned install fails (e.g., the requested version doesn't exist on the registry), existing lock entries for that module are destructively removed instead of leaving the lock file unchanged.

### Root Cause

`core/registry/ModuleInstaller.ts` line 452 calls `this.workspace.lockFile.addModule(moduleName, lockEntryToWrite)`. This calls `LockFile.addModule()` at `core/registry/LockFile.ts` line 272, which calls `save()` at line 278 — writing to `mlld-lock.json` immediately. The lock file is modified before the install is confirmed successful.

### Fix

Do not call `lockFile.addModule()` until the install has fully succeeded. Move the lock file write to after the module files are confirmed on disk. If the install fails at any point, the lock file must remain unchanged.

---

## Bug 2: `mlld update` overrides pinned versions

`mlld update` ignores version pins in the lock file and upgrades modules past their pinned version.

### Fix

Before updating a module, check if it has a pinned version in the lock file. If pinned, skip it (or update only within the pinned range if it's a semver range).

---

Note: `registry search` was reported as broken by QA but this appears to be a false positive. `registry info` works. Do NOT fix search or info — focus only on the two bugs above.

