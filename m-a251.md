---
id: m-a251
status: closed
deps: [m-2586]
created: 2026-02-02T22:12:06Z
type: task
priority: 2
assignee: Adam
updated: 2026-02-27T04:51:38Z
---
# Add mlld -e for inline code execution

## Feature Request

Add `mlld -e '<code>'` for quick one-liner execution, similar to `node -e`, `python -c`, `ruby -e`.

## Use Case

When debugging or testing small snippets:

```bash
mlld -e 'var @x = "test" | @json; show @x'
mlld -e 'show @now'
mlld -e 'var @files = <src/*.ts>; show @files.length'
```

## Current Workaround

Create temp file, run it, delete it:

```bash
echo 'show @now' > /tmp/test.mld && mlld /tmp/test.mld
```

## Impact

Significant friction during development and debugging.


**2026-02-18 00:48 UTC:** ## Implementation Plan

### Overview
Add `mlld -e '<code>'` for inline code execution. Follows the existing stdin input pattern (`isStdinInput`) as the blueprint — same cwd-based environment setup, but uses the string directly instead of reading from a file.

### Touch Points

#### 1. `cli/index.ts` — CLIOptions interface
- Add `eval?: string` field to `CLIOptions`

#### 2. `cli/parsers/ArgumentParser.ts` — Argument parsing
- Add case in the switch statement:
  ```
  case '-e':
  case '--eval':
    options.eval = args[++i];
    break;
  ```
- Update `validateOptions()`: allow `eval` as an alternative to `input` (currently throws 'No input file specified' when input is empty)
- Add validation: error if both `-e` and a file input are provided

#### 3. `cli/execution/FileProcessor.ts` — Execution
- In `processFileWithOptions()`, add `isEvalInput` branch alongside existing `isURL` / `isStdinInput` checks
- Environment setup: use `setupEnvironmentForStdin()` (cwd-based PathContext, same as stdin)
- In `executeInterpretation()`, add eval handling:
  - Use `cliOptions.eval` directly as `content` (skip `fs.readFile`)
  - Set `effectivePath` to `path.resolve(process.cwd(), '<eval>.mld')` (strict mode, no `/` prefix needed)
  - Force `stdout` output (no file output prompt — inline eval should always print to stdout)
- Pass `isEvalInput` through to `executeInterpretation()` (add parameter)

#### 4. `cli/interaction/HelpSystem.ts` — Documentation
- Add `-e '<code>'` to the help output under options
- Add examples section showing inline usage

### Behavioral Details
- **Default mode**: strict (like `.mld` files — no `/` prefix on directives)
- **Default output**: stdout (never prompt for output file)
- **CWD context**: imports resolve relative to cwd, same as stdin
- **stdin passthrough**: stdin content still available via `@input` when using `-e`
- **All other flags work**: `--inject`, `--timeout`, `--debug`, `--metrics`, etc.
- **Conflicting input**: error if both `-e` and a filename are provided

### Edge Cases
- Empty string: `mlld -e ''` — should produce empty output (not an error)
- Missing arg: `mlld -e` with no following arg — parser will get `undefined`, needs guard
- With stdin pipe: `echo data | mlld -e 'show @input.content'` — should work (stdin read still happens)
- With --mode markdown: `mlld -e --mode markdown '/show hello'` — should respect explicit mode override

### Not in Scope
- REPL mode (`mlld -i`) — separate feature
- Multi-expression chaining (`mlld -e 'expr1' -e 'expr2'`) — keep it simple, single eval string

**2026-02-18 07:18 UTC:** Implemented -e/--eval inline execution: parser + validation, FileProcessor eval path with cwd context and forced stdout, help text updates, and tests for parser and eval execution.
