---
id: m-2526
status: closed
deps: []
links: []
created: 2026-02-23T05:45:03Z
type: feature
priority: 1
assignee: Adam
updated: 2026-02-23T07:09:03Z
---
# Verify as auto-injected MCP tool for guard observability

When autoverify is enabled and an exe has a tools scope, auto-inject a `verify` tool into the tool collection. This lets the LLM call verify as a tracked tool visible to guards via `@mx.tools.calls.includes("verify")`.

Currently `mlld verify` runs as a shell command inside a subprocess — the parent mlld process has no observability into whether it was called. Guards can't enforce verification.

**Implementation:**
- When autoverify is enabled and tools scope exists, inject a `verify` tool definition
- Tool reads MLLD_VERIFY_VARS or accepts optional var names
- Returns JSON verification result (same as current `mlld verify` CLI)
- Tool call tracked by guard system
- Guard enforcement pattern: `guard @ensureVerified after llm = when [@mx.tools.calls.includes("verify") => allow, * => retry "Must verify"]`
- Remove the implicit `cmd:mlld:verify` capability allowance (guards.ts:454) once this replaces it


## Notes

**2026-02-23T06:02:26Z** Design consideration: the verify MCP tool should return structured results that guards can inspect — not just track that it was called. Guard should be able to check @mx.tools.results.verify.allPassed (or similar) to mechanistically enforce that verification succeeded. Without this, the guard only proves verify was called, not that it passed. With it, the entire chain is external enforcement: autosign → guard enforces verify call → guard enforces verify passed → no LLM trust decisions in the loop.
