---
id: m-478c
status: closed
deps: []
created: 2026-02-21T14:10:39Z
type: bug
priority: 1
assignee: Adam
updated: 2026-02-21T14:14:36Z
---
# Tool collection objects should not inherit tool labels as taint

When a `var tools` collection is defined with labeled tools, the collection object itself inherits those labels in its taint. This causes guards to fire on the collection metadata when it's passed as a parameter.

**Repro:**
```mlld
exe untrusted @searchWeb(q) = js { return 'results'; }
exe destructive @deleteDoc(id) = js { return 'deleted'; }

var tools @agentTools = {
  search: { mlld: @searchWeb, labels: ["untrusted"] },
  delete: { mlld: @deleteDoc, labels: ["destructive"] }
}

guard before destructive = when [
  @mx.taint.includes("untrusted") => deny "Blocked"
  * => allow
]

>> This fails â€” guard fires on @agentTools itself because it carries
>> ["untrusted", "destructive"] taint from the tool definitions
exe @agent(tools, task) = env with { tools: @tools } [
  => @task
]
var @result = @agent(@agentTools, "hello")
```

**Expected:** Tool collection objects are configuration/metadata. Their labels describe what the *tools* carry, not what the *collection object* is. Passing a tools collection as a parameter should not trigger data-taint guards.

**Impact:** Blocks the `exe @fn(tools, task) = env with { tools: @tools } [...]` pattern (m-b4e0) from being practical with labeled tools.

## Acceptance Criteria

- `var tools` collections do not carry tool definition labels in their own taint
- Passing a tools collection as a parameter does not trigger data-taint guards
- Tool labels still flow to `@mx.op.labels` when individual tools are *called*
- Existing guard behavior on actual tool calls unchanged


**2026-02-21 14:14 UTC:** Fixed: var tools no longer merges nested tool reference descriptors into collection taint/labels. Updated rhs dispatcher to skip descriptor collection for tools collections. Added regression tests for no-taint param passing and unchanged destructive guard behavior on actual tool calls. Verified with vitest: interpreter/eval/tools-collection.test.ts, interpreter/eval/exe-env-rhs.test.ts, interpreter/eval/var/rhs-dispatcher.test.ts.
