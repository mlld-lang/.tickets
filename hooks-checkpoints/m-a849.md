---
id: m-a849
status: closed
deps: []
created: 2026-02-19T23:02:01Z
type: task
priority: 1
assignee: Adam Avenir
tags: [severity-high, pre-ga]
updated: 2026-02-20T00:00:36Z
---
# Add runtime tests for data-label hooks

## Problem

Data-label hooks (`hook before untrusted = [...]`) are a spec-defined trigger type with a unique entry path, but no test exercises the full pipeline from label assignment through hook trigger to body execution.

## Evidence

- `user-hook-runner.ts:159-165` collects data hooks by iterating `operation.labels`
- `HookRegistry.test.ts:40-59` registers data hooks for indexing tests only
- No file in tests/ contains a runtime test that: (1) registers a data-label hook, (2) executes an operation with that label, (3) verifies hook body runs

## What to test

1. Register a data-label hook: `/hook @audit after untrusted = [ ... ]`
2. Execute an operation WITH that label: `/var untrusted @result = @someFunc()`
3. Verify the hook body runs and receives correct @input/@output
4. Test both before and after timing
5. Test transform vs observation-only behavior

