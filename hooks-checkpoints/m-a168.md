---
id: m-a168
status: closed
deps: []
created: 2026-02-20T16:05:53Z
type: task
priority: 3
assignee: Adam Avenir
tags: [severity-low, polish]
updated: 2026-02-24T19:46:50Z
---
# Add test for --resume implies --checkpoint

## Problem

`--resume` implies checkpoint behavior — the spec (`spec-hooks-checkpoints-resume.md:273`) says so, and the docs (`docs/user/flow-control.md:701`, `docs/user/cli.md:301`) confirm it. The implementation handles this because checkpoint caching is enabled by default unless `--no-checkpoint` is explicitly passed (see `interpreter/index.ts:402`). However, no test explicitly verifies that passing `--resume` without `--checkpoint` still produces checkpoint cache behavior.

Note: there is no `shouldEnableCheckpoint()` function — this ticket previously referenced a function that doesn't exist. The actual logic is the conditional at `interpreter/index.ts:402`: `if (options.noCheckpoint !== true && checkpointScriptName)`.

## Required change

Add a test to `tests/interpreter/checkpoint/resume-fork.test.ts` (which already has the test infrastructure — see `runScript()` helper and the `RunScriptOptions` interface at line 13).

The test should:

1. Run a script that contains an `exe` call (uses LLM / triggers checkpoint caching) with `resume: true` but **without** setting `checkpoint: true`.
2. Verify the checkpoint cache directory is created and contains cached results after the run.
3. Run the same script again with `resume: true` and verify the LLM call is served from cache (the counter should NOT increment on the second run).

This mirrors the existing tests in that file but specifically omits the `checkpoint: true` option to prove `resume` alone is sufficient.

## Acceptance criteria

- New test in `resume-fork.test.ts` named something like `"--resume without explicit --checkpoint still enables caching"`.
- Test passes: second run with `resume: true` (no `checkpoint` option) hits cache, not the LLM.
- All existing tests in the file continue to pass.

