---
id: m-9d66
status: closed
deps: []
created: 2026-02-19T23:01:59Z
type: bug
priority: 1
assignee: Adam Avenir
tags: [severity-high, pre-ga]
updated: 2026-02-20T00:00:36Z
---
# User after hooks do not fire on guard denial

## Problem

The spec states: "A guard can deny an operation, and the after hooks still fire (with the denial as the result)." But all three evaluation paths throw GuardError on denial, which bypasses user after hook execution.

## Evidence

- `directive.ts:234` — `handleGuardDecision()` throws GuardError, bypassing `runUserAfterHooks` at line 247
- `guard-policy.ts:594` — throws via `handleGuardDecision`, error re-thrown at line 622, prevents `finalizeResult()` from running after hooks
- `builtin-effects.ts:298-303` — throws without reaching after hooks at line 315

## Impact

The `@auditDenials` pattern from the spec cannot work:
```
hook @auditDenials after op:exe = when [
  @mx.guard.denied => [ append ... to "audit.log" ]
]
```

Any hook-based audit trail for guard denials is impossible.

## Fix

Wrap guard-decision + execution in try/catch that catches GuardError, creates denial-result EvalResult, runs `runUserAfterHooks`, then re-throws.

