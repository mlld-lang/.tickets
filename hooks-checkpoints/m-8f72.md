---
id: m-8f72
status: open
deps: [m-aacb]
created: 2026-02-18T17:09:31Z
type: task
priority: 1
assignee: Adam Avenir
updated: 2026-02-18T17:09:39Z
---
# Phase 0.5: Pre-3A risk reduction gates

Implement Phase 0.5 from `plan-hooks-checkpoints-resume.md`.

Context:
- This phase is a formal risk-reduction gate before Phase 3A lifecycle edits.
- It addresses known ambiguity around suppression boundaries, batch semantics, and resume resolution.

Scope:
- Add ADR/design bundle in `docs/dev` covering:
  - short-circuit protocol and adapter behavior
  - hook suppression matrix (normal / inside hook / inside guard)
  - `op:for:batch` boundary semantics
  - resume target precedence (`@fn`, `@fn:index`, `@fn("prefix")`)
- Add a test-only lifecycle trace helper for diagnosing ordering/suppression failures.
- Add golden integration fixture scaffolds for hooks+checkpoint+resume/fork behavior.
- Document checkpoint manifest versioning + atomic writes strategy.
- Document guard/cache-drift strategy (`--fresh` guidance; optional fingerprinting direction).

## Design

Treat this as enabling infrastructure for later phases:
- No new feature semantics yet.
- Add references from docs to test artifacts.
- Keep any scaffolding tests deterministic and runnable in CI.

## Acceptance Criteria

Exit criteria:
- Added test coverage:
  - lifecycle trace helper tests
  - checkpoint manifest schema/version compatibility tests or scaffolds
  - atomic write failure/recovery tests or scaffolds in checkpoint tests
- All tests pass:
  - `npm test tests/interpreter/hooks/ tests/interpreter/checkpoint/`
  - `npm run build`
  - `npm test`
- Docs updates complete:
  - `docs/dev/HOOKS.md`, `docs/dev/ARCHITECTURE.md`, `docs/user/security.md`
- Commit made after green tests:
  - `chore(runtime): add pre-3A risk-reduction ADRs, diagnostics, and persistence compatibility gates`

