---
id: m-935a
status: closed
deps: []
created: 2026-02-20T16:05:53Z
type: bug
priority: 2
assignee: Adam Avenir
tags: [severity-medium, pre-ga]
updated: 2026-02-24T19:46:49Z
---
# Anchor checkpoint cache path to project root

## Problem

`CheckpointManager` (`interpreter/checkpoint/CheckpointManager.ts:399`) resolves its cache root via:

```typescript
this.cacheRootDir = path.resolve(options.cacheRootDir ?? DEFAULT_CACHE_ROOT);
```

`DEFAULT_CACHE_ROOT` is the relative string `.mlld/checkpoints` (line 7). When no `cacheRootDir` option is passed, `path.resolve()` anchors it to `process.cwd()`. But the `run` command (`cli/commands/run.ts:175,291`) already calls `findProjectRoot()` (`core/utils/findProjectRoot.ts`) to locate the project root for script resolution. Running `mlld run` from a subdirectory creates orphaned cache dirs under that subdirectory instead of the project root.

## Required change

In `cli/commands/run.ts`, pass the `findProjectRoot()` result as the `checkpointCacheRootDir` option so it flows through to `CheckpointManager`. Specifically, set `checkpointCacheRootDir` to `path.join(projectRoot, '.mlld/checkpoints')` in the options object built around line 367.

The interpreter already accepts `checkpointCacheRootDir` in its options (`interpreter/index.ts:409-411`) and forwards it to `CheckpointManager` â€” the only change needed is in the CLI command where it constructs the options.

## Acceptance criteria

- Running `mlld run myscript` from a subdirectory of a project creates/reads the checkpoint cache at `<projectRoot>/.mlld/checkpoints/`, not `<cwd>/.mlld/checkpoints/`.
- Running from the project root behaves identically to current behavior.
- Existing tests in `tests/interpreter/checkpoint/` continue to pass.

