---
id: m-0989
status: open
deps: [m-9791]
created: 2026-02-18T17:09:31Z
type: task
priority: 0
assignee: Adam Avenir
updated: 2026-02-18T17:09:39Z
---
# Phase 3A: Ordering-only user hook lifecycle insertion

Implement Phase 3A ordering-only lifecycle insertion.

Scope:
- Insert user hook lifecycle around built-in hooks with NO transform chaining yet:
  - user before -> built-in pre -> execute -> built-in post -> user after
- Apply at directive, exec, and effect boundaries.
- Keep behavior observation-only (no value mutation semantics in this sub-phase).

## Design

High-coupling files:
- `interpreter/eval/directive.ts`
- `interpreter/eval/exec/guard-policy.ts`
- `interpreter/eval/exec-invocation.ts`
- `interpreter/eval/pipeline/builtin-effects.ts`

Use characterization-first loop from plan before/after each insertion-point edit.

## Acceptance Criteria

Exit criteria:
- Added test coverage:
  - characterization suite extended with user hook ordering expectations
  - guard parity tests retained/extended
- All tests pass:
  - `npm test tests/interpreter/hooks/lifecycle-characterization.test.ts tests/interpreter/guards/`
  - `npm run build`
  - `npm test`
- Docs updates complete:
  - `docs/dev/HOOKS.md` lifecycle diagram updated
- Commit made after green tests:
  - `feat(hooks): insert user hook lifecycle ordering around built-in guard hooks`

