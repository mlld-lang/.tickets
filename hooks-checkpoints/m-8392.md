---
id: m-8392
status: open
deps: [m-b8c7]
created: 2026-02-18T17:09:31Z
type: task
priority: 1
assignee: Adam Avenir
updated: 2026-02-18T17:09:39Z
---
# Phase 2: HookRegistry + /hook directive evaluation

Implement Phase 2 (HookRegistry + directive evaluation wiring).

Scope:
- Add `interpreter/hooks/HookRegistry.ts` with:
  - registration order
  - timing-aware retrieval (`before`/`after`)
  - indexed retrieval for function/op/data filters
- Attach registry to Environment with root/child semantics.
- Add `interpreter/eval/hook.ts` for `/hook` directive registration.
- Extend directive dispatch to evaluate/register hook directives.

## Design

Model API shape and behavior after `GuardRegistry`, but keep hook-specific matching semantics isolated.
Files:
- `interpreter/hooks/HookRegistry.ts`
- `interpreter/env/Environment.ts`
- `interpreter/eval/hook.ts`
- `interpreter/eval/directive.ts`

## Acceptance Criteria

Exit criteria:
- Added test coverage:
  - `tests/interpreter/hooks/HookRegistry.test.ts`
  - directive eval tests for hook registration path
- All tests pass:
  - `npm test tests/interpreter/hooks/`
  - `npm run build`
  - `npm test`
- Docs updates complete:
  - `docs/dev/HOOKS.md`
  - `docs/dev/ARCHITECTURE.md`
- Commit made after green tests:
  - `feat(hooks): add HookRegistry and /hook directive registration path`

