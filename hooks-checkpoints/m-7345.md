---
id: m-7345
status: closed
deps: []
created: 2026-02-20T16:05:53Z
type: bug
priority: 3
assignee: Adam Avenir
tags: [severity-low, polish]
updated: 2026-02-24T21:02:53Z
---
# Fix .env.test auto-loading documentation claim

## Problem

`docs/user/cli.md:356` says:

```
**Features:**
- Automatically loads `.env` and `.env.test` files from current directory
```

But `cli/utils/env-loader.ts:61-79` only loads `.env.test` when the `testMode` parameter is `true`:

```typescript
static autoLoadEnvFiles(baseDir: string, testMode: boolean = false): void {
  // ...
  if (testMode) {
    const testEnvFile = path.join(baseDir, '.env.test');
    // ...
  }
}
```

The test command at `cli/commands/test.ts:604` calls `EnvLoader.autoLoadEnvFiles(process.cwd())` **without** passing `testMode`, so `.env.test` is never loaded.

## Required change

Fix the code to match the documented behavior. In `cli/commands/test.ts:604`, change:

```typescript
EnvLoader.autoLoadEnvFiles(process.cwd());
```

to:

```typescript
EnvLoader.autoLoadEnvFiles(process.cwd(), true);
```

No docs changes needed â€” the docs are correct about the intended behavior.

## Acceptance criteria

- `mlld test` auto-loads `.env.test` when the file exists in the current directory.
- `.env.test` is NOT loaded by non-test commands (only the test command passes `testMode: true`).
- Existing tests continue to pass.

