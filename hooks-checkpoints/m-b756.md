---
id: m-b756
status: closed
deps: []
created: 2026-02-20T16:05:52Z
type: task
priority: 3
assignee: Adam Avenir
tags: [severity-medium, polish]
updated: 2026-02-24T19:46:50Z
---
# Data-label hooks match at operation level, not per-variable

## Problem

The spec implies per-variable granularity for data-label hooks ("when data receives the label"), but the implementation matches at the operation level only.

At `interpreter/hooks/user-hook-runner.ts:159-165`:

```typescript
const operationLabels = Array.isArray(operation?.labels) ? operation.labels : [];
for (const label of operationLabels) {
  if (typeof label !== 'string' || label.length === 0) { continue; }
  addUniqueHooks(matches, registry.getDataHooks(label, timing), seen);
}
```

This iterates the operation's label array and fires hooks for any matching label. But the hook fires for the entire operation context — there's no way to know which specific variable within the operation carried the label.

## Required change

This is a **docs-only** fix. The current operation-level matching is the correct behavior — update the spec to match implementation.

In `spec-hooks-checkpoints-resume.md`, find any language that implies data-label hooks fire per-variable or have per-variable granularity, and rewrite it to clearly state that data-label hooks match at the **operation level**: if any label on the operation matches the hook's data filter, the hook fires once for that operation.

## Acceptance criteria

- Spec language about data-label hooks accurately describes operation-level matching.
- No code changes.

