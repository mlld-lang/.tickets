---
id: m-3b88
status: closed
deps: []
created: 2026-02-21T07:42:12Z
type: bug
priority: 1
assignee: Adam
updated: 2026-02-21T11:50:14Z
---
# src:mcp taint should apply to MCP tool outputs only, not inputs to MCP-served tools

When mlld serves tools via `mlld mcp`, the MCP framework applies `src:mcp` taint to incoming tool arguments. This makes `src:mcp` useless for distinguishing 'data that originated from an external MCP tool call' from 'data the agent typed as a plain argument.'

Two different flows currently both apply `src:mcp`:

1. **Inbound MCP** (mlld imports tools from external MCP servers): tool OUTPUTS get `src:mcp` — correct, marks data from untrusted external sources.
2. **Outbound MCP** (mlld serves tools to external agents via `mlld mcp`): tool INPUTS get `src:mcp` — incorrect, marks data just because of transport protocol.

This breaks guards like:
```mlld
guard @noTaintedUrls before op:exe = when [
  @mx.op.labels.includes("net:r") && @mx.taint.includes("src:mcp") => deny "MCP-sourced data cannot be used in fetch URLs"
  * => allow
]
```

This guard intends to block data from OTHER MCP tools being exfiltrated via a URL. But because ALL inputs to MCP-served tools carry `src:mcp`, it blocks every call.

Fix: `src:mcp` should only be applied to outputs of MCP tool calls (inbound direction), not to inputs received by MCP-served tools (outbound direction).

The 'this was shaped by an LLM' signal is already handled by the `llm` exe label — no need for `src:mcp` to serve double duty.

Key file: cli/mcp/FunctionRouter.ts:204-209 (createMcpSecurityDescriptor) — this is where the taint is applied. The descriptor should be applied to the tool's output/result, not merged into the input arguments' context.

## Acceptance Criteria

1. Inputs to MCP-served tools (via mlld mcp) do NOT receive src:mcp taint
2. Outputs from imported MCP tools (via import tools from mcp) still receive src:mcp taint
3. Guards checking src:mcp on inputs to MCP-served tools no longer block all calls
4. Existing tests for inbound MCP taint continue to pass


**2026-02-21 11:50 UTC:** Fixed by removing FunctionRouter's unconditional meta.mcpSecurity injection so MCP-served tool inputs are no longer tagged src:mcp. Updated FunctionRouter and MCPServer tests to assert src:mcp is absent for MCP-served inputs, while keeping inbound MCP import taint coverage via interpreter/eval/import/mcp-import.test.ts. Verified with: npx vitest run cli/mcp/FunctionRouter.test.ts cli/mcp/MCPServer.test.ts interpreter/eval/import/mcp-import.test.ts (32 passing).
