---
id: m-891b
status: closed
deps: []
created: 2026-02-16T06:38:37Z
type: bug
priority: 0
assignee: Adam
updated: 2026-02-16T07:00:32Z
---
# Fix before LABEL double-transform in guard composition

When multiple before LABEL guards both transform unconditionally, the transform output gets doubled. Example: two guards both prepending 'PREFIX-' to secret-labeled data produce 'PREFIX-PREFIX-test' instead of 'PREFIX-test'.

QA confirmed in security-guard-composition topic (4 experiments).

## What to do
Find the guard chain execution in interpreter/hooks/. When multiple before guards transform a value, the output of the first transform is being fed back through the second transform AND the original transform is being re-applied. The second guard should receive the already-transformed value from the first guard, apply its own transform once, and pass the result forward.

Check interpreter/hooks/guard-runtime-evaluator.ts and guard-pre-hook.ts for how guard chains propagate transformed values.

## Acceptance criteria
- Two unconditional before LABEL transforms each apply once: input 'test' → 'A-test' → 'B-A-test' (not 'A-A-test' or 'A-B-A-test')
- Single before LABEL transform applies once
- Conditional transforms continue to work
- Add test case with multiple unconditional transforms in tests/cases/

