---
id: m-021d
status: closed
deps: []
created: 2026-02-16T17:07:49Z
type: bug
priority: 0
assignee: Adam
tags: [bug, validate, p0, qa-driven]
updated: 2026-02-16T17:24:41Z
---
# bug: mlld validate --format json missing guards and needs fields

## Problem

`mlld validate --format json` output is missing `guards` and `needs` fields that are documented. The JSON output includes `executables`, `exports`, `imports`, `warnings`, etc. but omits guard declarations and `/needs` blocks.

## Repro

```bash
cat > tmp/validate-json-test.mld << 'EOF'
/needs { sh }
guard @g before op:run = when [* => allow]
exe @hello() = show "hi"
export { @hello }
EOF
mlld validate tmp/validate-json-test.mld --format json
```

Expected: JSON output includes `guards: [...]\ and `needs: [...]\ fields.
Actual: those fields are missing or empty.

## Where to look

- `cli/commands/analyze.ts` — the JSON output formatter
- The guard extraction bug (m-XXXX) may be related — if guards aren't extracted, they can't be in the output
- Search for the JSON output assembly — look for where `executables`, `exports`, `imports` are collected and ensure `guards` and `needs` are included

## Fix

Add `guards` and `needs` to the JSON output. Guards should include name, timing (before/after/always), trigger (label name or op type), and whether privileged. Needs should list the declared capabilities.

## Source
QA run: qa/runs/2026-02-16-0/topics/validate-features/

