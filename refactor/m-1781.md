---
id: m-1781
status: open
deps: [m-7b5b]
links: []
created: 2026-02-09T06:24:51Z
type: task
priority: 1
assignee: Adam Avenir
parent: m-d11b
tags: [refactor, var, phase-1, security]
---
# Refactor Program: Modularize interpreter/eval/var.ts - Phase 1: Extract assignment context and descriptor services

Objective:
Extract assignment-context and security-descriptor helpers from `var.ts` without changing behavior.

Instructions for the implementing agent:
- Move identifier/metadata/security setup logic into focused helpers (example targets: `interpreter/eval/var/assignment-context.ts` and `interpreter/eval/var/security-descriptor.ts`).
- Extract descriptor collectors and merge helpers from `prepareVarAssignment`, including template/data AST descriptor scans.
- Preserve externally consumed exports (including `extractDescriptorsFromDataAst`) through re-export or compatibility wrapper if module boundaries change.
- Keep call order intact in `prepareVarAssignment` so downstream phases do not absorb behavior drift.
- Add focused unit tests for descriptor extraction/merge edge cases and assignment context generation.

## Acceptance Criteria

1. Assignment context and descriptor helper logic live in dedicated module(s) with narrow interfaces.
2. `prepareVarAssignment` behavior and exported API surface remain stable.
3. Added tests cover descriptor extraction/merge edge cases.
4. Exit criteria: all tests pass, with output attached:
   npm run build && npm test && npm run test:tokens && npm run test:examples

