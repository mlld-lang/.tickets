---
id: m-9251
status: open
deps: []
created: 2026-02-09T07:01:16Z
type: task
priority: 1
assignee: Adam Avenir
parent: m-225c
tags: [refactor, content-loader, phase-0]
updated: 2026-02-09T07:01:16Z
---
# Refactor Program: Modularize interpreter/eval/content-loader.ts - Phase 0: Baseline and characterization



Objective:
Establish behavioral coverage for all content-loader branches before extraction.

Instructions for the implementing agent:
- In scope: characterization tests and extraction-boundary mapping only.
- Out of scope: moving runtime logic across files.
- Map branch responsibilities: source reconstruction, AST extraction, url/file/glob handling, sections/transforms/pipelines, and result finalization.
- Add characterization tests for representative combinations (glob + section list, AST + transform, URL HTML conversion, optional loader behavior).
- Capture extraction seams and regression risk notes; do not move code across files in this phase.

Preserve behavior checks:
- Source reconstruction and policy-check behavior remain baseline-locked.
- AST extraction variant behavior remains baseline-locked.
- URL/HTML/file/glob flow parity remains baseline-locked.
- Section extraction and heading matching behavior remain baseline-locked.
- Finalization return-shape contracts remain baseline-locked.

## Acceptance Criteria

1. Characterization coverage exists for all listed preserve-behavior checks and representative branch combinations.
2. Baseline notes include concrete extraction boundaries and regression hazards.
3. No intentional runtime semantic change is introduced.
4. Exit criteria: test gate command succeeds and output is attached:
   npm run build && npm test && npm run test:tokens && npm run test:examples
