---
id: m-1f33
status: open
deps: [m-f706]
created: 2026-02-09T06:44:04Z
type: task
priority: 1
assignee: Adam Avenir
updated: 2026-02-09T06:44:10Z
---
# Refactor Program: Modularize interpreter/eval/run.ts - Phase 1: Extract pure helpers and pre-extracted input readers

Objective:
Extract deterministic helper logic from interpreter/eval/run.ts into focused modules without changing runtime behavior.

Instructions for the implementing agent:
- Move pure helper functions into a run helper module (for example: extractRawTextContent, dedentCommonIndent, resolveRunCodeOpType, mergeAuthUsing).
- Move pre-extracted input readers (run command, descriptor, stdin, and executable lookup helpers) into a dedicated run input-access module.
- Keep evaluateRun signature and externally visible behavior unchanged.
- Replace in-function helper usage with imports from extracted modules.
- Add focused tests for helper edge cases that are not already covered by characterization tests.
- Keep this phase as a code-move and wiring phase only; avoid behavior changes.

## Acceptance Criteria

1. Pure helpers and pre-extracted input readers live in dedicated modules with clear names.
2. evaluateRun remains behaviorally identical and imports extracted helpers.
3. Added helper tests pass.
4. Exit criteria (required before next phase): full test gate passes with output attached:
   npm run build && npm test && npm run test:tokens && npm run test:examples

