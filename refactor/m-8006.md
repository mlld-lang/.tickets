---
id: m-8006
status: open
deps: [m-cb49]
links: []
created: 2026-02-09T06:19:05Z
type: task
priority: 1
assignee: Adam Avenir
parent: m-ef4e
tags: [refactor, environment, phase-5, shadow-env, execution]
---
# Refactor Program: Modularize interpreter/env/Environment.ts - Phase 5: Extract shadow environment and execution orchestration

Objective:
Move shadow-environment and command/code execution orchestration into dedicated collaborators.

Instructions for the implementing agent:
- Extract shadow environment management (`setShadowEnv`, `getShadowEnv`, node/python getters/creation, capture methods) into a focused module.
- Extract command/code execution wrapper logic (`getCommandExecutorFactory`, `executeCommand`, `executeCode`) into an execution orchestrator component.
- Preserve language-specific behavior, especially js/node ambient `mx` injection and node/python shadow lifecycle behavior.
- Preserve compatibility with existing executors and their dependency contracts.

## Acceptance Criteria

1. Shadow-environment and execution wrapper logic are isolated behind clear APIs.
2. Language-specific execution behavior remains unchanged.
3. Existing shadow env and executor-focused tests remain green.
4. Exit criteria: full test gate passes with output attached:
   npm run build && npm test && npm run test:tokens && npm run test:examples

