---
id: m-118a
status: open
deps: [m-4c1a]
created: 2026-02-09T06:59:37Z
type: task
priority: 1
assignee: Adam Avenir
parent: m-943f
tags: [refactor, import-directive-evaluator, phase-4]
updated: 2026-02-09T06:59:37Z
---
# Refactor Program: Modularize interpreter/eval/import/ImportDirectiveEvaluator.ts - Phase 4: Extract module and node import handlers



Objective:
Modularize registry/module and node package import paths.

Instructions for the implementing agent:
- In scope: module candidate/fallback resolution, lock validation, and node package import handler extraction.
- Out of scope: resolver/input flow and file/url/directory flow extraction.
- Extract module candidate generation/fallback resolution and lock-file version validation into dedicated module import helpers.
- Extract node package import conversion/wrapping and processing-result validation into a node import handler module.
- Preserve local-module preference logic and no-exports failure behavior.

Module boundaries:
- Module import helper owns candidate generation, fallback ordering, and lock-file checks.
- Node import handler owns package conversion/wrapping and processing-result validation.
- Evaluator orchestrates module vs node routing.

Preserve behavior checks:
- Module candidate fallback order remains unchanged.
- Lock-file validation behavior remains unchanged.
- Local-module preference behavior remains unchanged.
- No-exports failure semantics remain unchanged.

## Acceptance Criteria

1. Module and node import logic is extracted into focused handlers.
2. Fallback, lock validation, and no-exports semantics remain baseline-compatible.
3. Tests cover module/node parity and failure behavior.
4. Exit criteria: test gate command succeeds and output is attached:
   npm run build && npm test && npm run test:tokens && npm run test:examples
