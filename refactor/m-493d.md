---
id: m-493d
status: closed
deps: [m-9251]
created: 2026-02-09T07:01:16Z
type: task
priority: 1
assignee: Adam Avenir
parent: m-225c
tags: [refactor, content-loader, phase-1]
updated: 2026-02-10T15:20:59Z
---
# Refactor Program: Modularize interpreter/eval/content-loader.ts - Phase 1: Extract source reconstruction and policy-aware read helpers



Objective:
Separate source/path/url reconstruction and policy-aware read logic.

Instructions for the implementing agent:
- In scope: source reconstruction/interpolation and policy-aware read helper extraction.
- Out of scope: AST extraction and section/finalization helper extraction.
- Extract source resolution helpers (`reconstructPath`, `reconstructUrl`, interpolation helpers) into a source module.
- Extract file/url read helpers with policy enforcement and descriptor recording semantics intact.
- Add tests for path interpolation, nullable suffix behavior, and policy-denied read handling.

Module boundaries:
- Source module owns path/url reconstruction and interpolation support.
- Read helper module owns file/url loading with policy enforcement and descriptor recording.
- Loader orchestrator consumes these modules through explicit interfaces.

Preserve behavior checks:
- Source reconstruction semantics remain unchanged.
- Policy denial handling remains unchanged.
- Descriptor recording semantics on reads remain unchanged.
- Nullable suffix/path interpolation behavior remains unchanged.

## Acceptance Criteria

1. Source reconstruction and policy-aware read helpers are extracted into focused modules.
2. Policy and descriptor behavior remain baseline-compatible.
3. Tests cover interpolation, nullable suffixes, and denied-read paths.
4. Exit criteria: test gate command succeeds and output is attached:
   npm run build && npm test && npm run test:tokens && npm run test:examples

**2026-02-10 15:20 UTC:** --dir refactor Completed extraction of source reconstruction and policy-aware read helpers: moved interpolate/path/url reconstruction into interpreter/eval/content-loader/source-reconstruction.ts and policy-enforced read into interpreter/eval/content-loader/policy-aware-read.ts; updated content-loader orchestrator delegation and nullable suffix handling via helper. Checklist/AC completed: source module extraction, policy+descriptor behavior parity, tests for interpolation/nullable/denied-read, full gate green. Tests: targeted suite PASS (npx vitest run interpreter/eval/content-loader.characterization.test.ts interpreter/eval/content-loader.test.ts interpreter/eval/content-loader-ast.test.ts interpreter/eval/content-loader-url.test.ts interpreter/eval/content-loader-markdown.test.ts interpreter/eval/content-loader-tagging.test.ts interpreter/eval/content-loader.structured.test.ts); full gate PASS x2 (npm run build && npm test && npm run test:tokens && npm run test:examples). Commit: 860113211.
