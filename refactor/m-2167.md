---
id: m-2167
status: open
deps: [m-3800]
links: []
created: 2026-02-09T06:24:52Z
type: task
priority: 1
assignee: Adam Avenir
parent: m-d11b
tags: [refactor, var, phase-8, pipeline]
---
# Refactor Program: Modularize interpreter/eval/var.ts - Phase 8: Extract pipeline post-processing and result rewriting

Objective:
Extract pipeline post-processing and final result rewriting.

Instructions for the implementing agent:
- Move pipeline execution/skip logic into focused helper module(s) (example target: `interpreter/eval/var/pipeline-finalizer.ts`).
- Preserve skip conditions exactly:
  - `ExecInvocation` with withClause
  - `VariableReference` with pipes
  - `load-content` with pipes
  - command values already handled through `evaluateRun`
- Preserve post-pipeline rewriting behavior for string and structured pipeline outputs.
- Ensure security metadata merge and finalization behavior remain stable after pipeline execution.
- Add focused tests for pipeline skip/execute matrix and post-pipeline variable rewriting.

## Acceptance Criteria

1. Pipeline skip/execute and result-rewrite logic is extracted into dedicated helper module(s).
2. Pipeline guard conditions and rewrite semantics remain unchanged.
3. Added tests cover skip/execute cases and output-shape rewrites.
4. Exit criteria: all tests pass, with output attached:
   npm run build && npm test && npm run test:tokens && npm run test:examples

