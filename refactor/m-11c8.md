---
id: m-11c8
status: closed
deps: [m-ce57]
created: 2026-02-09T07:06:40Z
type: task
priority: 1
assignee: Adam Avenir
parent: m-9747
tags: [refactor, core-interpreter, phase-1]
updated: 2026-02-10T11:53:46Z
---
# Refactor Program: Modularize interpreter/core/interpreter.ts - Phase 1: Extract array/document traversal and intent emission orchestration



Objective:
Isolate document traversal and non-directive intent emission orchestration with stable ordering guarantees.

Instructions for the implementing agent:
- In scope: extract document-array traversal and intent emission orchestration only.
- Out of scope: single-node dispatch table extraction, variable resolver extraction, interpolation/security logic.
- Move duplicated array-processing logic into `interpreter/core/interpreter/traversal.ts` (or equivalent).
- Preserve emission rules for text/newline/comment/code-fence/run-block/template wrapper paths and node recording.
- Add tests for frontmatter and non-frontmatter traversal ordering and emitted intent equivalence.

Module boundaries:
- Traversal module owns iteration order and intent dispatch for array nodes only.
- Node-specific evaluation remains delegated through existing entry points.
- Traversal module does not own interpolation security or variable resolution.

Preserve behavior checks:
- Intent/effect ordering matches baseline in mixed-node documents.
- Node recording and wrapper emission behavior remains unchanged.
- Document reconstruction behavior from traversal outputs remains unchanged.

## Acceptance Criteria

1. Array/document traversal and non-directive intent emission are extracted into a focused module.
2. Ordering, wrapper emission, and reconstruction behavior remain baseline-compatible.
3. Preserve-behavior checks are asserted in focused traversal tests.
4. Exit criteria: test gate command succeeds and output is attached:
   npm run build && npm test && npm run test:tokens && npm run test:examples

**2026-02-10 11:52 UTC:** --dir refactor Implemented phase slice: extracted array/document traversal and non-directive intent emission into interpreter/core/interpreter/traversal.ts; interpreter/core/interpreter.ts now delegates array handling to evaluateArrayNodes while preserving frontmatter-first and branch-specific ordering. Completed checklist items: extraction module boundary, ordering/wrapper/reconstruction parity, focused traversal tests added in interpreter/core/interpreter/traversal.test.ts (frontmatter/non-frontmatter ordering + emitted intent equivalence). Tests: npm test -- interpreter/core/interpreter.characterization.test.ts interpreter/core/interpreter/traversal.test.ts (PASS); npm run build && npm test && npm run test:tokens && npm run test:examples (PASS).

**2026-02-10 11:53 UTC:** --dir refactor Phase complete after commit 99302b092. Post-commit validation: npm run build && npm test && npm run test:tokens && npm run test:examples (PASS).
