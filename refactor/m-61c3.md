---
id: m-61c3
status: closed
deps: [m-e21c]
created: 2026-02-09T07:04:59Z
type: task
priority: 1
assignee: Adam Avenir
parent: m-a97c
tags: [refactor, variable-importer, phase-3]
updated: 2026-02-10T14:28:01Z
---
# Refactor Program: Modularize interpreter/eval/import/VariableImporter.ts - Phase 3: Extract import type routing orchestration



Objective:
Separate import subtype routing from variable construction internals.

Instructions for the implementing agent:
- In scope: import subtype routing orchestration extraction only.
- Out of scope: variable creation strategies and executable rehydration extraction.
- Extract `handleImportType` and top-level subtype routing logic into an import routing module.
- Preserve subtype behavior for policy, namespace, and selected imports.
- Add tests for subtype dispatch and guard registration wiring at import boundaries.

Module boundaries:
- Import routing module owns subtype dispatch and handoff to subtype handlers.
- Routing module does not implement variable construction details.
- Policy and guard registration calls remain explicit routing side effects.

Preserve behavior checks:
- Policy/namespace/selected subtype dispatch behavior remains unchanged.
- Guard registration wiring at import boundaries remains unchanged.
- Routing error semantics remain unchanged.

## Acceptance Criteria

1. Import subtype routing logic is extracted into a dedicated module.
2. Subtype behavior and guard registration wiring remain baseline-compatible.
3. Tests cover dispatch parity across policy, namespace, and selected imports.
4. Exit criteria: test gate command succeeds and output is attached:
   npm run build && npm test && npm run test:tokens && npm run test:examples

**2026-02-10 14:28 UTC:** --dir refactor Phase 3 completed.\n- Changes: extracted import subtype dispatch into ImportTypeRouter and rewired VariableImporter.handleImportType to delegate namespace/policy/selected routing through explicit handler callbacks.\n- Checklist completed: policy/namespace/selected dispatch parity preserved; selected-import guard registration wiring preserved at routing boundary; wildcard and unknown subtype error semantics preserved.\n- Added tests: interpreter/eval/import/variable-importer/import-type-router.test.ts (dispatch, guard registration wiring, wildcard error, unknown subtype error).\n- Targeted tests: npx vitest run interpreter/eval/import/variable-importer/import-type-router.test.ts interpreter/eval/import/variable-importer/*.test.ts interpreter/eval/import/variable-importer.characterization.test.ts interpreter/eval/import/*.test.ts (pass).\n- Full gate (pass): npm run build && npm test && npm run test:tokens && npm run test:examples.\n- Commit: 5cb6f790e (refactor(variable-importer): complete m-61c3 extract import type routing orchestration).
