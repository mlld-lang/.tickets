---
id: m-3887
status: open
deps: [m-43a7]
created: 2026-02-09T06:44:04Z
type: task
priority: 1
assignee: Adam Avenir
updated: 2026-02-09T06:44:11Z
---
# Refactor Program: Modularize interpreter/eval/run.ts - Phase 4: Extract direct run-code execution path

Objective:
Isolate runCode path behavior into a dedicated code execution module.

Instructions for the implementing agent:
- Extract direct runCode handling (code block text extraction, dedent, argument materialization, and executeCode invocation).
- Preserve AutoUnwrapManager usage, argument descriptor collection, and policy/label-flow checks.
- Preserve operation-context updates derived from language capability mapping.
- Preserve working-directory resolution semantics and execution-context propagation.
- Add focused tests for argument extraction (variable refs and primitives), language mapping, and policy-denied code execution.

## Acceptance Criteria

1. runCode path is extracted behind a dedicated module with explicit inputs/outputs.
2. Behavior for argument extraction, policy checks, and executeCode invocation remains consistent.
3. Focused runCode tests pass.
4. Exit criteria (required before next phase): full test gate passes with output attached:
   npm run build && npm test && npm run test:tokens && npm run test:examples

