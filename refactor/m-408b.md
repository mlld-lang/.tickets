---
id: m-408b
status: open
deps: [m-8006]
links: []
created: 2026-02-09T06:19:05Z
type: task
priority: 1
assignee: Adam Avenir
parent: m-ef4e
tags: [refactor, environment, phase-6, scope, lifecycle]
---
# Refactor Program: Modularize interpreter/env/Environment.ts - Phase 6: Unify child-environment lifecycle and scope merge

Objective:
Reduce duplication and isolate lifecycle logic for child environment creation, inheritance, and merge behavior.

Instructions for the implementing agent:
- Introduce a child-environment lifecycle helper that owns shared behavior currently split between `createChild` and `createChildEnvironment`.
- Preserve import resolver child creation semantics, policy/tool inheritance, streaming/provenance inheritance, and trace inheritance.
- Keep `mergeChild` behavior exactly consistent, including block-scoped variable exclusions and node merge behavior.
- Add focused tests for child lifecycle and merge semantics if coverage is incomplete.

## Acceptance Criteria

1. Child creation paths share a clear internal lifecycle implementation with reduced duplication.
2. Child inheritance and merge semantics remain unchanged.
3. Scope and import behavior tests remain green.
4. Exit criteria: full test gate passes with output attached:
   npm run build && npm test && npm run test:tokens && npm run test:examples

