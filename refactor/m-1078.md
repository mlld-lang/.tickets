---
id: m-1078
status: open
deps: [m-2e93]
created: 2026-02-09T07:06:40Z
type: task
priority: 1
assignee: Adam Avenir
parent: m-9747
tags: [refactor, core-interpreter, phase-5]
updated: 2026-02-09T07:06:40Z
---
# Refactor Program: Modularize interpreter/core/interpreter.ts - Phase 5: Extract interpolation and security recording helpers



Objective:
Centralize interpolation helper behavior and security recording contracts.

Instructions for the implementing agent:
- In scope: extract interpolation helper and security descriptor recording integration.
- Out of scope: dispatch table changes, variable resolver changes, and namespace utility extraction.
- Move `interpolateWithSecurityRecording` and related helper wiring into `interpreter/core/interpreter/interpolation-security.ts` (or equivalent).
- Preserve descriptor collection, merge behavior, and recording semantics across all call sites.
- Add tests for descriptor capture/merge ordering and cases with no descriptors.

Module boundaries:
- Interpolation/security module exposes a small API for interpolation + descriptor recording.
- Module does not own node dispatch or variable resolver behavior.
- Call sites pass explicit context and descriptor collectors.

Preserve behavior checks:
- `interpolate` output behavior remains unchanged.
- Security descriptor capture and merge semantics remain baseline-compatible.
- Descriptor recording order remains stable in multi-interpolation flows.
- No descriptor loss occurs across adapter boundaries.

## Acceptance Criteria

1. Interpolation/security helper logic is extracted into a dedicated module with explicit interfaces.
2. Descriptor recording and merge behavior remains baseline-compatible.
3. Preserve-behavior checks are covered by focused interpolation/security tests.
4. Exit criteria: test gate command succeeds and output is attached:
   npm run build && npm test && npm run test:tokens && npm run test:examples
