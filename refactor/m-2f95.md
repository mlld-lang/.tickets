---
id: m-2f95
status: open
deps: [m-a2a7]
created: 2026-02-09T06:59:37Z
type: task
priority: 1
assignee: Adam Avenir
parent: m-943f
tags: [refactor, import-directive-evaluator, phase-7]
updated: 2026-02-09T06:59:37Z
---
# Refactor Program: Modularize interpreter/eval/import/ImportDirectiveEvaluator.ts - Phase 7: Final composition cleanup and module boundary verification



Objective:
Reduce `ImportDirectiveEvaluator.ts` to composition/orchestration.

Instructions for the implementing agent:
- In scope: final orchestration cleanup, dependency-direction checks, and parity verification.
- Out of scope: introducing new import semantics or public contract changes.
- Refactor `evaluateImport` and routing methods to delegate to extracted services with minimal in-class branching.
- Remove duplicated helper logic and dead code introduced during phased extraction.
- Attach architecture notes describing new module boundaries, dependency flow, and ownership.
- Run final parity checks across MCP/resolver/module/node/file/url/directory flows plus policy/needs/binding enforcement paths.

Module boundaries:
- `ImportDirectiveEvaluator.ts` acts as orchestration entrypoint only.
- Extracted services have acyclic dependencies and explicit ownership by import type and safety concern.
- `evaluateImport` public contract remains unchanged.

Preserve behavior checks:
- Import type inference and error semantics remain unchanged.
- MCP/resolver/module/node/file/url/directory branch parity remains unchanged.
- Needs/policy enforcement and binding collision guarantees remain unchanged.
- Alias resolution behavior remains unchanged.

Micro-checklist (final import parity gate):
- Add integrated cases combining directory imports + module imports + policy context to assert unchanged end-state bindings.
- Add integrated cases where needs enforcement and binding collisions can both trigger and assert unchanged precedence/error shape.
- Add one cross-branch parity case each for MCP, resolver, module/node, and file/url/dir flows under shared policy constraints.
- Add alias-resolution conflict cases in mixed import sets and assert unchanged final error behavior.

## Acceptance Criteria

1. `ImportDirectiveEvaluator.ts` is orchestration-focused with clear, acyclic module boundaries.
2. Runtime behavior, error surface, and metadata contracts remain baseline-compatible.
3. Final parity checks cover all preserve-behavior requirements listed in this ticket.
4. Every item in the micro-checklist is backed by explicit tests before closing this phase.
5. Exit criteria: test gate command succeeds and output is attached:
   npm run build && npm test && npm run test:tokens && npm run test:examples
