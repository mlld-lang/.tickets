---
id: m-69d1
status: open
deps: [m-c639]
created: 2026-02-09T06:36:42Z
type: task
priority: 1
assignee: Adam Avenir
parent: m-15ea
tags: [refactor, pipeline-executor, phase-7]
updated: 2026-02-09T06:36:43Z
---
# Refactor Program: Modularize interpreter/eval/pipeline/executor.ts - Phase 7: Extract execution loop and streaming lifecycle

Objective:
Separate execution-loop control flow and streaming lifecycle from the executor composition root.

Instructions for the implementing agent:
- Extract main pipeline-loop orchestration (`execute`) into collaborators that handle state transitions and event emission.
- Isolate streaming lifecycle concerns (`emitStream`, stage streaming checks, teardown behavior).
- Preserve state-machine transition behavior, iteration safety guard, and return-structured semantics.
- Add tests for event ordering on success/failure/abort and teardown behavior in `finally` paths.

## Acceptance Criteria

1. Execution-loop and streaming lifecycle concerns are separated into focused modules.
2. Public `PipelineExecutor.execute` behavior remains backward-compatible.
3. Exit criteria: all tests pass with output attached:
   npm run build && npm test && npm run test:tokens && npm run test:examples
