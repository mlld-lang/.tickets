---
id: m-5413
status: closed
deps: [m-72ac]
created: 2026-02-12T03:22:29Z
type: task
priority: 1
assignee: Adam
updated: 2026-02-12T05:16:46Z
---
# Consolidation Program: Phase 1 shared utility extraction (safe set)

Implement low-risk shared utility extraction: canonical interpolate-and-record helper, AST node guards, and shared string helpers where behavior is demonstrably equivalent.

## Acceptance Criteria

- Extract only behavior-identical utilities validated in baseline.
- Preserve existing public contracts and test snapshots.
- Before committing this phase, run `npm test` and `npm run build`; both must pass.


**2026-02-12 05:16 UTC:** --dir=refactor Phase 1 implementation complete (safe extraction only):
- Added shared AST node/type guard utilities in interpreter/core/interpreter/node-guards.ts and switched evaluator dispatch guards to use them.
- Added shared handler utilities in interpreter/core/interpreter/handlers/shared-utils.ts for command string normalization and EvalResult wrapping.
- Updated thin core handlers to use shared wrappers/command helper without changing behavior.
- Extracted canonical interpolate+security-record helper in interpreter/core/interpreter/interpolation-security.ts and reused it from interpreter/eval/data-values/PrimitiveEvaluator.ts.

Verification evidence:
- Focused parity tests: PASS
  - npx vitest run interpreter/core/interpreter/handlers/specialized-handlers.test.ts interpreter/core/interpreter/interpolation-security.test.ts interpreter/core/interpreter/dispatch.test.ts interpreter/core/interpreter/namespace-display.test.ts
- npm test: PASS (Test Files: 360 passed, 7 skipped; Tests: 3935 passed, 63 skipped)
- npm run build: PASS
