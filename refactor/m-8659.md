---
id: m-8659
status: closed
deps: [m-fd91]
created: 2026-02-09T07:06:40Z
type: task
priority: 1
assignee: Adam Avenir
parent: m-9747
tags: [refactor, core-interpreter, phase-3]
updated: 2026-02-10T12:11:20Z
---
# Refactor Program: Modularize interpreter/core/interpreter.ts - Phase 3: Extract variable reference and field/pipeline resolver handler



Objective:
Modularize variable-reference evaluation and field/pipeline resolution with stable context rules.

Instructions for the implementing agent:
- In scope: extract variable-reference branch logic, field traversal, and pipeline-tail application.
- Out of scope: dispatch table changes, interpolation/security extraction, or effect emission orchestration changes.
- Move variable-reference handler logic to `interpreter/core/interpreter/resolve-variable-reference.ts` (or equivalent).
- Preserve resolver fallback ordering, `commandRef` handling, field access traversal, and condensed-pipe evaluation behavior.
- Add tests for field access success/failure, pipeline tail chaining, commandRef invocation, and expression-context missing-variable semantics.

Module boundaries:
- Resolver module consumes context and reference AST, returns resolved value or throws baseline-compatible errors.
- Resolver module does not own document-level intent/effect emission.
- Pipeline-tail application remains explicit and testable within resolver boundaries.

Preserve behavior checks:
- Field access and pipeline-tail semantics remain baseline-compatible.
- Expression-context missing-variable behavior remains stable.
- `commandRef` resolution and invocation behavior remains unchanged.
- Resolver fallback precedence remains unchanged.

## Acceptance Criteria

1. Variable-reference and field/pipeline resolution logic is extracted into a dedicated handler module.
2. Resolver fallback and error semantics remain baseline-compatible.
3. Preserve-behavior checks are covered by targeted resolver tests.
4. Exit criteria: test gate command succeeds and output is attached:
   npm run build && npm test && npm run test:tokens && npm run test:examples

**2026-02-10 12:09 UTC:** Phase implementation complete:
- Extracted VariableReference branch logic into interpreter/core/interpreter/resolve-variable-reference.ts and routed interpreter.ts to delegate through resolveVariableReference().
- Preserved zero-offset workaround behavior, resolver fallback ordering, commandRef handling, field traversal, and condensed-pipe processing.
- Added focused tests in interpreter/core/interpreter/resolve-variable-reference.test.ts for field access success/failure behavior, pipeline-tail chaining, commandRef invocation, and expression-context missing-variable semantics.
- Follow-up cleanup: switched resolver internal dynamic imports to path aliases for style consistency.

Checklist/acceptance progress:
- [x] Dedicated resolver module for variable reference + field/pipeline handling
- [x] Baseline-compatible fallback/error semantics preserved
- [x] Preserve-behavior checks covered by targeted tests

Tests run:
- npm test -- interpreter/core/interpreter/resolve-variable-reference.test.ts interpreter/core/interpreter/dispatch.test.ts interpreter/core/interpreter.characterization.test.ts interpreter/core/interpreter/traversal.test.ts  => PASS
- npm run build && npm test && npm run test:tokens && npm run test:examples  => PASS

**2026-02-10 12:11 UTC:** Phase complete.
- Commit: a3b81a86d
- Post-commit full gate rerun: npm run build && npm test && npm run test:tokens && npm run test:examples => PASS
- Exit criteria satisfied; phase ready to close.
