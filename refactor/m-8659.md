---
id: m-8659
status: open
deps: [m-fd91]
created: 2026-02-09T07:06:40Z
type: task
priority: 1
assignee: Adam Avenir
parent: m-9747
tags: [refactor, core-interpreter, phase-3]
updated: 2026-02-09T07:06:40Z
---
# Refactor Program: Modularize interpreter/core/interpreter.ts - Phase 3: Extract variable reference and field/pipeline resolver handler



Objective:
Modularize variable-reference evaluation and field/pipeline resolution with stable context rules.

Instructions for the implementing agent:
- In scope: extract variable-reference branch logic, field traversal, and pipeline-tail application.
- Out of scope: dispatch table changes, interpolation/security extraction, or effect emission orchestration changes.
- Move variable-reference handler logic to `interpreter/core/interpreter/resolve-variable-reference.ts` (or equivalent).
- Preserve resolver fallback ordering, `commandRef` handling, field access traversal, and condensed-pipe evaluation behavior.
- Add tests for field access success/failure, pipeline tail chaining, commandRef invocation, and expression-context missing-variable semantics.

Module boundaries:
- Resolver module consumes context and reference AST, returns resolved value or throws baseline-compatible errors.
- Resolver module does not own document-level intent/effect emission.
- Pipeline-tail application remains explicit and testable within resolver boundaries.

Preserve behavior checks:
- Field access and pipeline-tail semantics remain baseline-compatible.
- Expression-context missing-variable behavior remains stable.
- `commandRef` resolution and invocation behavior remains unchanged.
- Resolver fallback precedence remains unchanged.

## Acceptance Criteria

1. Variable-reference and field/pipeline resolution logic is extracted into a dedicated handler module.
2. Resolver fallback and error semantics remain baseline-compatible.
3. Preserve-behavior checks are covered by targeted resolver tests.
4. Exit criteria: test gate command succeeds and output is attached:
   npm run build && npm test && npm run test:tokens && npm run test:examples
