---
id: m-2042
status: open
deps: [m-e217]
created: 2026-02-09T06:36:42Z
type: task
priority: 1
assignee: Adam Avenir
parent: m-15ea
tags: [refactor, pipeline-executor, phase-5]
updated: 2026-02-09T06:36:42Z
---
# Refactor Program: Modularize interpreter/eval/pipeline/executor.ts - Phase 5: Extract single-stage orchestration

Objective:
Refactor single-stage orchestration into a dedicated stage-runner component.

Instructions for the implementing agent:
- Extract `executeSingleStage` orchestration responsibilities (stage-env construction, operation context, retry loop, pre/post effects sequencing).
- Preserve rate-limit retry behavior, guard-driven retry behavior, and pipeline-context lifetime boundaries.
- Keep stage hook-node and command execution context generation behavior intact.
- Add coverage for effect ordering, retry flow, and stage-context lifecycle behavior.

## Acceptance Criteria

1. Single-stage execution orchestration is moved behind a dedicated collaborator.
2. Retry/effect/context behavior remains stable under characterization tests.
3. Exit criteria: all tests pass with output attached:
   npm run build && npm test && npm run test:tokens && npm run test:examples
