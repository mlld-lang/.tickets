---
id: m-d138
status: closed
deps: []
created: 2026-02-04T06:25:34Z
type: task
priority: 2
assignee: Adam
tags: [urgency-high, j2bd-mcp]
updated: 2026-02-04T06:28:35Z
---
# Fix policy label flow for VariableReference exe arguments

EC4 FAIL: Policy label flow rules (labels.src:mcp.deny) not enforced for exe arguments passed as variable references.

Root cause: In interpreter/eval/exec-invocation.ts, when an exe argument is a VariableReference (line 1877-1933), the variable's value is extracted but its security descriptor is NOT collected into resultSecurityDescriptor. Compare with object/array literal cases (lines 1854-1874) which DO call mergeResultDescriptor(objDescriptor).

This means when @destroy(@mcpData) runs, @mcpData's taint (src:mcp) is invisible to checkLabelFlow at line 2331.

Fix: In the VariableReference case (after line 1883 where variable is confirmed to exist), add:
```
const varDescriptor = varMxToSecurityDescriptor(variable.mx);
if (varDescriptor) mergeResultDescriptor(varDescriptor);
```

Import varMxToSecurityDescriptor from @core/types/variable/VarMxHelpers if not already imported.

Verify with: tmp/adversarial-mcp-4b-policy-enforce.mld
```
import tools { @echo } from mcp "node tests/support/mcp/fake-server.cjs"
var @policyConfig = { labels: { "src:mcp": { deny: ["destructive"] } } }
policy @p = union(@policyConfig)
var @mcpData = @echo({ text: "mcp data" })
exe destructive @destroy(data) = `destroyed: @data`
var @result = @destroy(@mcpData)
show @result
```
Expected: Policy denial error (Label 'src:mcp' cannot flow to 'destructive')

Also check that ExecInvocation args (line 1945-1968) may need the same treatment - nested exe calls may also lose descriptors.


**2026-02-04 06:28 UTC:** Verified no functional impact: (1) exe destructive @destroy(@mcpData) correctly denied via parameter binding path (lines 2430-2453), (2) run cmd { echo "@mcpData" } correctly denied via interpolation taint propagation. The missing mergeResultDescriptor is a code cleanliness issue, not a security gap.
