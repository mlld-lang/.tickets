---
id: m-9f46
status: closed
deps: []
created: 2026-02-09T10:58:45Z
type: task
priority: 2
assignee: Adam Avenir
tags: [urgency-high, excellence-fix]
updated: 2026-02-09T11:04:16Z
---
# Fix excellence gaps: paths, polish, and demo

Excellence assessment (m-95b1) found 3 fundamental gaps and 6 polish gaps. Fix all of them.

## Fundamental Gaps

### 1. Fix audit-ledger-demo.mld paths
File: `llm/run/j2bd/security/impl/audit-ledger-demo.mld`
- Line 24: Change `output @token to "audit-ledger-demo.txt"` → `output @token to "@base/tmp/audit-ledger-demo.txt"`
- Line 32: Change `var @loaded = <audit-ledger-demo.txt>` → `var @loaded = <@base/tmp/audit-ledger-demo.txt>`
- Line 44: Update the find pattern to match new path: `event.path.endsWith("audit-ledger-demo.txt")`
- Line 50: Change `show \`  Taint: @writeEvent.taint\`` - This shows WRONG data due to .taint property shadowing by mx metadata. Fix by extracting taint via JS function instead. Add a new exe:
```
exe @getTaint(event) = js { return JSON.stringify(event.taint || []); }
```
Then use `show \`  Taint: @getTaint(@writeEvent)\``

### 2. Fix label-tracking.md File I/O example paths
File: `docs/src/atoms/security/label-tracking.md`
- Lines 51-55: Change to use @base/ prefix:
```mlld
var secret @token = "sk-live-123"
output @token to "@base/tmp/demo.txt"

var @loaded = <@base/tmp/demo.txt>
show @loaded.mx.labels     // ["secret"]
```

### 3. Handle .taint property shadowing in demo
Already addressed in gap 1 above (use JS extraction). Also add a brief note in audit-log.md about this:
```
**Note:** When working with audit events in mlld, use `@event | @json` or a JS function to access the `taint` field, since `.taint` on a variable accesses the variable's metadata, not the JSON property.
```

## Polish Gaps

### 4. Add mlld programmatic query example to audit-log atom
File: `docs/src/atoms/security/audit-log.md`
After the shell examples (line 50), add:
```mlld
var @audit = <@base/.mlld/sec/audit.jsonl>
exe @findWrites(events) = js {
  return events.filter(e => e.event === "write");
}
show @findWrites(@audit) | @json
```

### 5. Add label-tracking to audit-log cross-references
File: `docs/src/atoms/security/audit-log.md`
- Line 8: Change `related: [labels-overview, label-modification, signing-overview, policy-label-flow]` → add `security-label-tracking` to the list

### 6. Fix phantom atom cross-references in labels-source-auto.md
File: `docs/src/atoms/security/labels-source-auto.md`
- Line 8: Change `related: [labels-overview, labels-propagation, guards-basics, labels-mx-context]` → `related: [labels-overview, security-label-tracking, guards-basics, labels-sensitivity]` (labels-propagation and labels-mx-context don't exist; label-tracking covers propagation, labels-sensitivity covers the mx context)

### 7. Fix phantom related-code references across 4 atoms
`core/security/LabelTracker.ts` doesn't exist → actual file is `core/security/taint.ts`
`interpreter/eval/security.ts` doesn't exist → actual file is `interpreter/eval/label-modification.ts`

Files to update:
- `docs/src/atoms/security/labels-sensitivity.md` line 9: `related-code: [core/security/LabelTracker.ts, interpreter/eval/security.ts]` → `related-code: [core/security/taint.ts, interpreter/eval/label-modification.ts]`
- `docs/src/atoms/security/labels-source-auto.md` line 9: same change
- `docs/src/atoms/security/label-tracking.md` line 10: `related-code: [core/security/LabelTracker.ts]` → `related-code: [core/security/taint.ts]`
- `docs/src/atoms/security/policy-label-flow.md` line 9: `related-code: [interpreter/eval/policy.ts, core/security/LabelTracker.ts]` → `related-code: [interpreter/eval/policy.ts, core/security/taint.ts]`

### 8. Add 'writer: null' clarification to audit-log atom
File: `docs/src/atoms/security/audit-log.md`
After line 42 (`writer` stores the first available source tag when present), add:
`When no source tag is available (e.g., for inline-declared values), `writer` is `null`.`

### 9. Add common-mistakes note to label-tracking atom
File: `docs/src/atoms/security/label-tracking.md`
After the File I/O example (after line 58), add a note:
`**Note:** If `@loaded.mx.labels` shows `[]`, check that you declared the sensitivity label on the original variable (e.g., `var secret @token`). Labels are not inferred from content—they must be declared explicitly.`


**2026-02-09 11:04 UTC:** All 9 gaps fixed and verified. Demo runs cleanly. Phantom cross-references replaced.
