---
id: m-5325
status: closed
deps: []
created: 2026-02-04T01:52:14Z
type: task
priority: 2
assignee: Adam
tags: [phase-2, mcp, security]
updated: 2026-02-04T01:57:50Z
---
# Create MCP security demonstration script

Create a working MCP security demonstration that shows all five exit criteria scenarios:

1. Import MCP tools (use the fake-server at tests/support/mcp/fake-server.cjs)
2. Show that tool outputs have src:mcp taint automatically
3. Show guard blocking secret data from flowing to MCP tools
4. Show policy restricting MCP tool operations
5. Show audit trail/logging of MCP tool usage

**Implementation notes:**
- MCP calls go through op:exe, NOT op:mcp. Guards use `before op:exe` with `@mx.taint.includes('src:mcp')` checks.
- The fake MCP server at tests/support/mcp/fake-server.cjs provides echo and ping tools.
- Use `import tools { @echo, @ping } from mcp "node tests/support/mcp/fake-server.cjs"` for the server spec.
- Policy uses `var @config = { labels: { 'src:mcp': { deny: [...] } } }; policy @p = union(@config)`
- Place the demo script at pipeline/mcp-security-demo.mld
- Reference the existing sandbox-demo.mld at pipeline/sandbox-demo.mld for style.
- Must pass `mlld validate` for syntax checking.

**Guard patterns to demonstrate:**
```mlld
guard @noSecretToMcp before op:exe = when [
  @mx.taint.includes("src:mcp") and @input.any.mx.labels.includes("secret") => deny "Secrets cannot flow to MCP tools"
  * => allow
]

guard @auditMcp after op:exe = when [
  @mx.taint.includes("src:mcp") => [
    log `MCP call: @mx.op.name`
    allow
  ]
  * => allow
]
```

