---
id: m-5f55
status: closed
deps: []
created: 2026-02-09T15:53:07Z
type: task
priority: 2
assignee: Adam Avenir
tags: [urgency-high, bug]
updated: 2026-02-09T15:58:27Z
---
# Fix opLabels ReferenceError in exe + using auth path

BUG: `exe @check() = run cmd { echo } using auth:test` followed by `@check()` crashes with `ReferenceError: opLabels is not defined`.

Direct `run cmd { ... } using auth:name` works. The bug is specifically in the exe invocation path when the withClause contains auth.

**Root cause**: In `interpreter/eval/exec-invocation.ts:2937`, bare `opLabels` is used as a shorthand property in checkLabelFlow. But `const opLabels` is only declared inside the if/else branches at lines 2268 (isCommandExecutable), 2335 (isCodeExecutable), and 2371 (isNodeExecutable). Line 2937 is in the common code path AFTER those branches close at line 2414, so `opLabels` is out of scope.

**Fix**: Change line 2937 from `opLabels,` to `opLabels: operationContext.opLabels ?? [],` â€” this is the exact same pattern already used at line 2520 for the same situation.

**Verification**: After fixing, run `mlld tmp/test-exe-auth-show.mld` with this content:
```
var @policyConfig = { auth: { test: { from: "env:HOME", as: "MY_HOME" } } }
policy @p = union(@policyConfig)
exe @check() = run cmd { echo "$MY_HOME" } using auth:test
show @check()
```
Should print the home directory path instead of crashing.

