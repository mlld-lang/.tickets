---
id: m-0a26
status: closed
deps: []
created: 2026-02-06T02:36:39Z
type: task
priority: 2
assignee: Adam
tags: [j2bd-security, doc, urgency-high]
updated: 2026-02-06T02:42:07Z
---
# Polish gaps PG-1 through PG-8 from excellence assessment

Address all 8 polish gaps identified by the excellence assessment (m-320c).

## PG-1: mcp-security atom examples trigger validator warning
Replace `npx @anthropic/echo-server` with `node tests/support/mcp/fake-server.cjs` in all 3 examples. This avoids the `@anthropic undefined variable` validator warning that confuses new users.

File: docs/src/atoms/security/mcp-security.md line 17

## PG-2: env-config atom example 2 references undefined @cfg
Add `var @cfg = { profiles: { full: { requires: { sh: true } }, readonly: { requires: {} } } }` before the `env @cfg with { profile: 'readonly' }` block.

File: docs/src/atoms/security/env-config.md lines 44-57

## PG-3: Cross-references don't connect the four MCP atoms
Update `related:` frontmatter:
- mcp-security: add mcp-policy, mcp-guards
- mcp-policy: add mcp-guards (already has mcp-security)
- mcp-guards: add mcp-policy (already has mcp-security)
- env-config: add mcp-security, mcp-policy, mcp-guards

## PG-4: Demo Scenario 1 doesn't display taint
Add `show @echoResult.mx.taint | @json` and `show @derived.mx.taint | @json` to demo Scenario 1 so users can see the actual taint arrays.

File: j2bd/security/artifacts/mcp-security-demo.mld lines 38-46

## PG-5: Demo Scenario 3 avoids actually triggering policy denial
Wrap the destructive MCP data call in an exe with a `denied =>` handler to actually demonstrate the policy denial. Replace the comment-only approach (lines 112-122) with an actual call that shows the error being caught. NOTE: The excellence worker reported that policy denials are hard errors not catchable by `denied =>`. If this is the case, use a try-like pattern or simply call the destructive op as the last statement before the summary, documenting that the script would terminate there. Whichever approach works, the user should SEE the denial happen.

## PG-6: mcp-policy atom doesn't mention policy denials are hard errors
Add a note after the last example: 'Policy denials are hard errors â€” the operation fails immediately. Unlike guard denials, they cannot be caught with `denied =>` handlers. Use policy for absolute constraints and guards for cases needing graceful fallback. See `security-denied-handlers` for guard denial handling.'

File: docs/src/atoms/security/mcp-policy.md, after line 57

## PG-7: Key quoting style inconsistency
Standardize key quoting across atoms and demo: use unquoted keys for simple identifiers (labels, deny, allow, servers, defaults, unlabeled) and quoted keys only when the key contains special characters (like "src:mcp"). Update the demo artifact to match.

File: j2bd/security/artifacts/mcp-security-demo.mld (uses fully quoted keys in many places)

## PG-8: Profile fallback behavior undocumented
Add to env-config atom after the @mcpConfig() example: 'When no profile is specified in the `env` block, the first defined profile is used as the default.'

File: docs/src/atoms/security/env-config.md, around line 59

## Validation
After all changes, run `mlld validate` on each atom example to confirm no warnings. Also run `mlld j2bd/security/artifacts/mcp-security-demo.mld` to verify the demo still works end-to-end.

