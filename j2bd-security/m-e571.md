---
id: m-e571
status: closed
deps: []
created: 2026-02-06T01:06:24Z
type: task
priority: 2
assignee: Adam
tags: [urgency-high, phase-2]
updated: 2026-02-06T01:22:38Z
---
# Create MCP security demonstration artifact

Create the Phase 2 implementation artifacts for the MCP security job.

## Requirements

Create two mlld files in j2bd/security/artifacts/:

### 1. `mcp-env-module.mld` - Environment module with @mcpConfig()

Based on the target example, create an environment module that:
- Has a `profiles` block with `full` and `readonly` profiles
- Defines `exe @mcpConfig()` using `when` to adapt to `@mx.profile`
- Has `policy @config` with label flow rules for `secret` and `src:mcp`
- Exports `@spawn`, `@shell`, `@mcpConfig`

### 2. `mcp-security-demo.mld` - Full demonstration script

Create a comprehensive demo that exercises ALL exit criteria:

1. **src:mcp auto-taint**: Import MCP tools, call them, show that output carries `src:mcp` taint
2. **Guard blocking secrets**: Define a `guard for secret` that blocks secret-labeled data from flowing to exe operations (including MCP tools)
3. **Policy restricting src:mcp data**: Set up policy with `labels: { "src:mcp": { deny: ["destructive"] } }` and demonstrate that MCP-sourced data is blocked from destructive operations
4. **Profile-based tool availability**: Show @mcpConfig() returning different configs for different profiles

The demo should be runnable with `mlld run` and produce clear output showing each security feature working.

## Key patterns from atoms

- mcp-security: `import tools { @echo } from mcp "npx @anthropic/echo-server"` for MCP tools
- mcp-policy: `policy @p = union(@policyConfig)` with labels block
- mcp-guards: `guard @name for secret = when [...]`
- env-config: `exe @mcpConfig() = when [@mx.profile == "full" => ...]`

## Validation

- All mlld files must pass `mlld validate`
- Use `show` statements to display results so the demo is self-documenting
- Follow existing artifact patterns (see builtin-rules-demo.mld and file-taint-demo.mld for style)

