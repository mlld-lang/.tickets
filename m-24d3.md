---
id: m-24d3
status: closed
deps: []
created: 2026-02-16T05:06:22Z
type: bug
priority: 0
assignee: Adam
updated: 2026-02-16T05:48:06Z
---
# Fix null stringification in exe cmd conditional fragments

When null is passed as a parameter to an exe using run cmd, conditional fragments like @param?`fragment` output the literal string "null" instead of omitting the fragment. Works correctly in template-based exe definitions.

## Root cause

In interpreter/eval/run-modules/run-exec-definition-dispatcher.ts, handleCommandDefinition() (lines 217-220):
```typescript
const tempEnv = env.createChild();
for (const [key, value] of Object.entries(argValues)) {
  tempEnv.setParameterVariable(key, createSimpleTextVariable(key, value));
}
```

argValues has type Record<string, string> â€” null has already been stringified to "null" by the arg evaluation pipeline. createSimpleTextVariable stores "null" as text, so isTruthy("null") returns true and the conditional fragment is included.

The direct exec-invocation path (interpreter/eval/exec-invocation.ts) uses bindExecParameterVariables() which calls createParameterVariable() from interpreter/utils/parameter-factory.ts. This preserves actual null, so isTruthy(null) returns false and the fragment is correctly omitted.

## What to do

Change handleCommandDefinition to use argRuntimeValues (already available in RunExecDefinitionDispatchParams) with createParameterVariable instead of createSimpleTextVariable:

```typescript
const tempEnv = env.createChild();
for (const [key, stringValue] of Object.entries(argValues)) {
  const runtimeValue = argRuntimeValues[key];
  const paramVar = createParameterVariable({
    name: key, value: runtimeValue, stringValue, origin: 'directive'
  });
  tempEnv.setParameterVariable(key, paramVar ?? createSimpleTextVariable(key, stringValue));
}
```

Apply the same fix to handleTemplateDefinition (line 680-681) which has the same issue.

## Acceptance criteria
- exe @greet(name, title) = cmd { echo "@title?`@title `@name" } with null title omits the fragment
- Template-based exe continues to work with null parameters
- Legitimate string "null" values remain truthy
- Add test cases for null parameters in cmd exe definitions in tests/cases/

