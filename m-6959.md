---
id: m-6959
status: closed
deps: []
created: 2026-01-29T18:31:14Z
type: bug
priority: 0
assignee: Adam
---
# Function parameter bindings leak to parent scope (variable shadowing bug)

**FIXED** - Parameters are now properly block-scoped via `mx.importPath === 'exe-param'` check.

## Problem

When calling a function, the parameter bindings from the callee were leaking back to the caller's scope via `mergeChild()`. This caused confusing behavior where a variable suddenly had a different value after a function call.

## Root Cause

In `exe.ts:evaluateExeBlock()`:
1. Parameters were set with `createVariableFromValue(param, value, 'exe-param', ...)`
2. This correctly marked them with `mx.importPath = 'exe-param'`
3. BUT `Environment.mergeChild()` only skipped `let` bindings, not `exe-param` bindings
4. So parameters leaked back to parent scope

## Fix

Updated two locations to treat `'exe-param'` the same as `'let'`:

1. `interpreter/env/Environment.ts:mergeChild()` - Skip both `let` and `exe-param` bindings when merging child environment back to parent

2. `interpreter/env/VariableManager.ts:setVariable()` - Allow both `let` and `exe-param` to shadow parent scope variables without throwing redefinition errors

## Verification

- Existing test `feat/exe-param-shadowing` passes
- Manual test confirms parent variables are preserved after function calls

