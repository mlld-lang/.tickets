---
id: m-a623
status: closed
deps: []
created: 2026-02-21T12:41:50Z
type: feature
priority: 0
assignee: Adam
updated: 2026-02-21T14:17:15Z
---
# Support configless env syntax: env with { ... } [...]

Allow env blocks without a predefined config variable. Currently env requires a config expression as its first argument:

```mlld
var @cfg = {}
env @cfg with { tools: @agentTools } [...]
```

This forces users to declare throwaway variables. The fix: make config optional when a with clause is present.

**Three valid forms:**
- `env @config [...]` — predefined config (already works)
- `env @config with { ... } [...]` — predefined + overrides (already works)
- `env with { ... } [...]` — inline only (NEW)

`env [...]` with neither config nor with clause remains an error.

**Grammar change** in grammar/directives/env.peggy: make config optional in SlashEnv rule. When config is absent, interpreter treats it as empty config `{}` — the with clause provides everything.

**Interpreter change** in interpreter/eval/env.ts: handle missing config by defaulting to `{}`.

## Acceptance Criteria

- `env with { tools: @myTools } [...]` parses in strict and markdown mode
- `env with { profile: "readonly" } [...]` works
- `env [...]` without config or with clause gives clear error
- Existing `env @config [...]` and `env @config with {...} [...]` still work


**2026-02-21 14:17 UTC:** Implemented in commit 4c2310768: configless env syntax in grammar and interpreter default handling for missing config, with coverage in grammar/tests/env.test.ts and interpreter/eval/env-directive.test.ts.
