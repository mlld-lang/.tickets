---
id: m-3b36
status: closed
deps: [m-0a7c]
created: 2026-02-02T22:05:56Z
type: task
priority: 0
assignee: Adam
updated: 2026-02-12T20:44:39Z
---
# let shadows var instead of erroring

## Bug

Inside a block (loop, when action, etc.), `let @run = {...@run, ...}` creates a NEW block-scoped variable that shadows the outer `var @run`. After the block ends, the outer variable is unchanged.

## Reproduction

```mlld
var @run = { id: "original" }
show `Original: @run.id`

loop(2) [
  show `Before let: @run.id`
  let @run = { ...@run, modified: true }
  show `After let: @run.id, modified: @run.modified`
]

show `After loop: @run.id`
show `Has modified? @run.modified`  >> null - outer var unchanged!
```

## Expected Behavior

Either:
1. `let` should error when trying to redefine a var-scoped variable
2. Or `let` should update the existing variable (probably not - this breaks immutability)

## Impact

This bug is in the J2BD pipeline at index.mld lines 290, 318, 383, 420, 459 where `let @run = {...@run, lastWorkerResult: ...}` fails to persist state across loop iterations.

## Validation Gap

`mlld validate` passes this code without warning. It should detect and reject `let` redefining a `var`-scoped variable.


**2026-02-12 20:44 UTC:** Verified fixed: let inside blocks now throws VariableRedefinition error when redefining outer var-scoped variables. Error includes original definition location and guidance.
